import streamlit as st
import time
import smtplib
from email.mime.text import MIMEText
# ==========================================
# 0. Email 設定與函數 (請填入你的資料)
# ==========================================
# ★★★ 請在此填入你的 Gmail ★★★
SENDER_EMAIL = "mbti.test.free.highschool@gmail.com"
# ★★★ 請在此填入剛剛申請的 16 位數應用程式密碼 ★★★
APP_PASSWORD = "wsii xjlb rvio pnmj"

def send_result_email(user_email, mbti_types, universe):
    try:
        # 1. 準備信件內容
        msg = MIMEText(f"""
        你好！感謝參與【多重宇宙 MBTI】測驗。
       
        🌌 你所在的宇宙：{universe}
        🎯 你的測驗結果：{', '.join(mbti_types)}
       
        這是一個充滿可能性的世界，希望你喜歡這個結果！
       
        (此為系統自動發送，請勿回覆)
        """, 'plain', 'utf-8')
       
        msg['Subject'] = f"🌌 你的多重宇宙 MBTI 測驗結果：{mbti_types[0]}"
        msg['From'] = SENDER_EMAIL
        msg['To'] = user_email

        # 2. 連線到 Gmail 伺服器
        server = smtplib.SMTP('smtp.gmail.com', 587)
        server.starttls() # 加密傳輸
        server.login(SENDER_EMAIL, APP_PASSWORD)
       
        # 3. 寄出並斷線
        server.send_message(msg)
        server.quit()
        return True
    except Exception as e:
        print(f"寄信失敗: {e}") # 會印在終端機方便除錯
        return False
# ==========================================
# 1. 頁面基礎設定
# ==========================================
st.set_page_config(page_title="多重宇宙 MBTI", page_icon="🌌")

# ==========================================
# 2. CSS 美化 (安全配色版)
# ==========================================
st.markdown("""
    <style>
    /* 大標題樣式 */
    .big-title {
        font-size: 60px;
        font-weight: 900;
        text-align: center;
        background: -webkit-linear-gradient(45deg, #FF0099, #493240);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        margin-bottom: 10px;
    }
    /* 小標題樣式 */
    .sub-title {
        font-size: 24px;
        text-align: center;
        opacity: 0.7; /* 不指定顏色，只調透明度，適應深淺模式 */
        margin-bottom: 30px;
    }
   
    /* --- 選項按鈕美化 --- */
    /* 1. 外框設定 */
    div[role="radiogroup"] label > div:first-of-type {
        border: 2px solid #888 !important; /* 改成中性灰，深淺都看得到 */
    }
   
    /* 2. 選中時的圓圈顏色 */
    div[role="radiogroup"] > label[data-baseweb="radio"] > div:first-child {
        background-color: #FF4B4B !important;
        border-color: #FF4B4B !important;
    }
   
    /* 3. 選項文字設定 (移除強制黑色，改用系統預設) */
    div[role="radiogroup"] label p {
        font-size: 19px !important;
        font-weight: 600;
        /* color: #333;  <-- 兇手是這行！我把它拿掉了 */
    }
   
    /* 4. 滑鼠移過去的效果 */
    div[role="radiogroup"] label:hover {
        background-color: rgba(128, 128, 128, 0.1); /* 半透明灰，深淺通用 */
        border-radius: 10px;
    }
    </style>
""", unsafe_allow_html=True)

# ==========================================
# 3. 狀態初始化
# ==========================================
if 'page' not in st.session_state:
    st.session_state.page = 'landing'
if 'target_theme' not in st.session_state:
    st.session_state.target_theme = None
if 'tie_themes' not in st.session_state:
    st.session_state.tie_themes = []

# ==========================================
# 4. 前導測驗題目 (5題)及四大劇本(各25題) MBTI introduction
# ==========================================
# ==========================================
# 4-3. 人格詳細資料 (200字深度解析版)
# ==========================================
MBTI_INFO = {
    "ESTJ": {
        "title": "總經理", "color": ["#5B86E5", "#36D1DC"],
        "match": "ISFP", "clash": "INFP",
        "desc": "在一個分崩離析的世界裡，你是那根支撐大局的鋼鐵脊樑。當其他人都因為恐懼而不知所措，或因為道德兩難而猶豫不決時，你是唯一一個還記得清點彈藥、檢查防禦工事、並建立值班表的人。你相信「秩序」是生存的唯一解方，混亂對你來說比喪屍更可怕。你並不享受冷酷，但你願意承擔那個「壞人」的角色，去制定那些艱難但必要的規則。你的愛不是溫暖的擁抱，而是堅固的圍牆與準時的配給。雖然常被誤解為缺乏感情，但你的隊友內心深處都知道：只要跟著你走，存活率就是最高的。你是秩序的化身，是文明重建的基石。",
        "strengths": ["極強的組織與執行力，不拖泥帶水", "意志堅定，危機時刻能穩定軍心", "忠誠且負責，承諾必達", "講求實效，能快速解決混亂"],
        "weaknesses": ["難以接受異議，容易顯得獨斷", "過於強勢，無意間給予他人壓力", "忽視情感需求，被視為冷血", "對突發變化的適應力較慢"],
        "career": {
            "zombie": "基地指揮官 / 治安官",
            "fantasy": "皇家騎士團長 / 攝政王",
            "school": "學生會長 / 風紀股長",
            "cyber": "巨型企業執行長 / 鎮暴隊長"
        }
    },
    "ENTJ": {
        "title": "指揮官", "color": ["#8E2DE2", "#4A00E0"],
        "match": "INFP", "clash": "ISFP",
        "desc": "你是天生的帝王，擁有超越常人的宏觀視野。在你的眼中，眼前的危機只是暫時的棋局，你已經在計算十步之後的勝利。你擁有強大的意志力和決斷力，在絕境中，你是那個敢於做出「必要犧牲」的人。你對於效率有著近乎偏執的追求，無法容忍任何形式的無能或拖延。你擅長發掘每個人的潛力，並將他們放在最合適的位置上（無論他們願不願意）。你或許不是最討人喜歡的夥伴，但絕對是最強大的盟友。你的野心不僅僅是生存，而是要征服這個混亂的世界，在廢墟之上建立起屬於你的新秩序。",
        "strengths": ["極具領袖魅力，能統御全局", "長遠的戰略目光，走一步看三步", "理性果斷，不受情緒干擾", "善於解決複雜的系統性難題"],
        "weaknesses": ["容易忽視他人的感受與尊嚴", "顯得傲慢與不耐煩", "對低效率零容忍，標準過高", "可能為了目標不擇手段"],
        "career": {
            "zombie": "倖存者領袖 / 軍閥",
            "fantasy": "帝國皇帝 / 征服者",
            "school": "模擬聯合國主席 / 辯論隊長",
            "cyber": "黑幫老大 / 政變策劃者"
        }
    },
    "ESFJ": {
        "title": "供給者", "color": ["#F2994A", "#F2C94C"],
        "match": "ISFP", "clash": "INTJ",
        "desc": "你是團隊中最溫暖的心臟，也是維繫人性的關鍵紐帶。在殘酷的環境下，活著很容易變成行屍走肉，但你確保了大家還能像「人」一樣有尊嚴地生活。你擁有驚人的社交雷達，總能第一時間察覺誰受傷了、誰在忍耐、誰快要崩潰了。你會為了隊友的生日而在廢墟中翻找一整天只為了一根蠟燭，因為你知道這能凝聚人心。你維護著團體的和諧，任何破壞團結的行為都會讓你感到不安。你或許不是戰鬥力最強的，但沒有你，隊伍的精神早就分崩離析了。你是守護大家心靈的港灣。",
        "strengths": ["極強的團隊凝聚力與親和力", "無微不至的照顧與後勤能力", "致力於維護和諧與人際關係", "忠誠且樂於奉獻"],
        "weaknesses": ["過度在乎他人評價，容易受傷", "習慣犧牲自己成全別人", "難以面對衝突與批評", "有時會情緒化用事"],
        "career": {
            "zombie": "物資分配官 / 醫療護理長",
            "fantasy": "神殿祭司 / 治療師",
            "school": "班長 / 康樂股長",
            "cyber": "地下診所醫生 / 情報掮客"
        }
    },
    "ENFJ": {
        "title": "主人公", "color": ["#ff9966", "#ff5e62"],
        "match": "INFP", "clash": "ISTP",
        "desc": "你是充滿魅力的精神領袖，擁有能夠點燃他人靈魂的火花。你看得見每個人潛在的價值，甚至比他們自己更相信他們。當眾人因絕望而低頭時，你是那個站出來發表演講、重燃希望火光的人。你相信人性本善，即使在最黑暗的時刻，你也堅持道德底線，拒絕讓隊伍淪為野獸。你的直覺很強，能輕易洞察人心，並用話語治癒創傷。你為了保護夥伴可以奮不顧身，但有時會因為承擔了太多他人的痛苦與期待，而讓自己精疲力竭。你是照亮黑暗的燈塔。",
        "strengths": ["卓越的溝通與演說能力", "極強的同理心與洞察力", "能激勵他人共同奮鬥", "富有理想與責任感"],
        "weaknesses": ["過度理想化，容易忽略現實", "容易過度承擔責任而過勞", "對批評過於敏感", "有時會過度干涉他人決定"],
        "career": {
            "zombie": "精神領袖 / 談判專家",
            "fantasy": "聖騎士 / 勇者",
            "school": "社團社長 / 校園偶像",
            "cyber": "反抗軍領袖 / 革命家"
        }
    },
    "ISTJ": {
        "title": "物流師", "color": ["#134E5E", "#71B280"],
        "match": "ESFP", "clash": "ENFP",
        "desc": "你是沈默而可靠的磐石，是亂世中最穩定的力量。你不喜歡空談夢想，只相信數據、事實和過往的經驗。在末日中，你是那個會去檢查每一扇門窗是否鎖好、計算每一顆子彈、並嚴格執行配給制度的人。你的責任感極強，一旦承諾就會貫徹到底，絕不輕言放棄。你對混亂感到厭惡，會盡一切努力建立SOP（標準作業程序）。雖然你常被認為不懂變通或過於嚴肅，但當危機發生時，大家都會下意識地躲在你的身後，因為你是最讓人安心的存在。",
        "strengths": ["極度可靠，做事有始有終", "注重細節，精確度高", "冷靜且實際的判斷力", "優秀的後勤與資源管理"],
        "weaknesses": ["固執，不喜歡改變現狀", "對不遵守規則的人缺乏耐心", "不擅長表達情感", "容易因為細節失誤而焦慮"],
        "career": {
            "zombie": "軍械庫管理員 / 狙擊手",
            "fantasy": "王國守衛 / 史官",
            "school": "圖書股長 / 會計",
            "cyber": "數據分析師 / 刑警"
        }
    },
    "ISFJ": {
        "title": "守衛者", "color": ["#6190E8", "#A7BFE8"],
        "match": "ESFP", "clash": "ENTP",
        "desc": "你是溫柔的守護天使，總是默默地在幕後付出而不求回報。你擁有驚人的記憶力，記得每個隊友的血型、過敏原和喜好。在危險面前，你不會像英雄一樣大吼大叫，但你會堅定地擋在弱者身前，用盡全力保護他們。你非常勤奮，願意承擔那些枯燥但必要的工作。你對於「傳統」和「家」的概念非常執著，即使在廢墟中，你也會努力營造出一種家的溫馨感。你的善良不是軟弱，而是末日中最後的淨土，提醒著大家我們還保有良知。",
        "strengths": ["無私的奉獻與極佳的耐心", "細心且觀察力敏銳", "極強的忍耐力與忠誠度", "擅長支持與輔助他人"],
        "weaknesses": ["不懂得拒絕他人請求", "容易壓抑自己的需求", "對改變環境感到恐懼", "容易悲觀思考"],
        "career": {
            "zombie": "戰地醫生 / 農夫",
            "fantasy": "藥草師 / 精靈弓手",
            "school": "衛生股長 / 志工",
            "cyber": "仿生人維修師 / 護理師"
        }
    },
    "INTJ": {
        "title": "策劃者", "color": ["#232526", "#414345"],
        "match": "ENFP", "clash": "ESFJ",
        "desc": "你是孤獨的智者，擁有穿越時間的遠見。當別人在想著下一餐吃什麼時，你已經在計算三個月後的糧食危機和應對方案了。你把世界看作一盤巨大的棋局，所有的變數、人心、資源都在你的計算之中。你極度理性，認為情緒是影響判斷的雜訊，因此常被誤解為冷漠。你喜歡獨立工作，對愚蠢和低效的行為容忍度極低。雖然你不擅長社交，但你的策略往往能帶領團隊避開滅頂之災。你是幕後的操盤手，是能在絕境中找出唯一活路的人。",
        "strengths": ["極具戰略眼光與預判力", "理性客觀，不受情緒干擾", "善於優化系統與流程", "獨立且自信，不隨波逐流"],
        "weaknesses": ["顯得冷漠與傲慢", "過度分析，容易忽略當下", "不擅長團隊合作", "對他人標準要求過高"],
        "career": {
            "zombie": "首席策略師 / 科學家",
            "fantasy": "大法師 / 煉金術士",
            "school": "資優生 / 學生會軍師",
            "cyber": "AI 架構師 / 幕後黑手"
        }
    },
    "INFJ": {
        "title": "提倡者", "color": ["#833ab4", "#fd1d1d"],
        "match": "ENTP", "clash": "ESTP",
        "desc": "你是神秘的先知，擁有看透人心的直覺。你能敏銳地察覺到空氣中未說出口的緊張，或是某個隊友隱藏的惡意。你雖然外表安靜，但內心有著強烈的道德準則和救世情懷。在末日中，你不僅關注生存，更關注「為什麼而活」。你常常是團隊的精神支柱，用深邃的智慧指引迷途的靈魂。你既溫柔又堅定，為了信念，你可以爆發出驚人的力量。你總是能在絕望中看見一線生機，並引導大家走向那個可能並不存在的烏托邦。",
        "strengths": ["驚人的直覺與洞察力", "堅定的信念與價值觀", "善於鼓舞人心與輔導", "富有創造力與深意"],
        "weaknesses": ["容易過度消耗精力", "極度敏感，容易受傷", "過於完美主義", "難以被他人真正理解"],
        "career": {
            "zombie": "顧問 / 心理學家",
            "fantasy": "預言家 / 隱士",
            "school": "輔導老師 / 文學社長",
            "cyber": "記憶讀取者 / 心靈駭客"
        }
    },
    "ESTP": {
        "title": "企業家", "color": ["#F7971E", "#FFD200"],
        "match": "ISFJ", "clash": "INFJ",
        "desc": "你是天生的戰士，為了行動而生。你活在當下，擁有極快的反應速度和環境適應力。當喪屍衝出來時，你是第一個拔槍開火的人，完全不需要猶豫。你討厭枯燥的理論和長篇大論的會議，你信奉「做了再說」。你的冒險精神讓你在末日如魚得水，危機對別人來說是災難，對你來說卻是遊樂場。你雖然衝動，但總能憑藉著機智和運氣化險為夷。你是隊伍中最強的戰力，也是最不可控的變數，永遠衝在最前面。",
        "strengths": ["反應極快，行動力強", "適應力與觀察力極佳", "大膽且無所畏懼", "擅長解決燃眉之急"],
        "weaknesses": ["衝動，不計後果", "缺乏長遠規劃", "容易感到無聊", "不喜歡遵守規則"],
        "career": {
            "zombie": "突擊隊長 / 特技駕駛",
            "fantasy": "賞金獵人 / 傭兵",
            "school": "體育校隊隊長",
            "cyber": "職業殺手 / 賽車手"
        }
    },
    "ESFP": {
        "title": "表演者", "color": ["#FF0099", "#493240"],
        "match": "ISTJ", "clash": "INTJ",
        "desc": "你是廢墟中的派對之王，走到哪裡就把光與熱帶到哪裡。你認為即使明天是末日，今天也要快樂地過。你擁有極佳的審美和表演慾，會用歌聲、舞蹈或笑話來緩解大家的恐懼。你是最棒的即興發揮者，總能利用手邊的資源創造驚喜。雖然有人覺得你沒心沒肺，但你的樂觀是支撐團隊精神健康最重要的支柱。你提醒大家：我們是人，不是求生的機器。你的存在本身就是對抗絕望最好的武器。",
        "strengths": ["樂觀開朗，充滿感染力", "擅長隨機應變", "極佳的社交手腕", "敏銳的感官體驗"],
        "weaknesses": ["缺乏專注力", "逃避嚴肅的問題", "容易情緒化", "不擅長長期規劃"],
        "career": {
            "zombie": "娛樂官 / 外交聯絡人",
            "fantasy": "吟遊詩人 / 舞者",
            "school": "熱舞社社長 / 校園網紅",
            "cyber": "虛擬偶像 / 情報販子"
        }
    },
    "ENTP": {
        "title": "辯論家", "color": ["#DA22FF", "#9733EE"],
        "match": "INFJ", "clash": "ISFJ",
        "desc": "你是瘋狂的發明家，腦子裡裝滿了無數個點子。你喜歡挑戰權威，質疑既有的規則。在末日中，當大家都想著怎麼「守成」時，你卻在想著怎麼「創新」，例如用喪屍來發電，或是改造出超酷的戰車。你反應極快，口才極佳，擅長用邏輯把人繞暈。雖然你的某些想法很危險，甚至有點反社會，但往往就是這些瘋狂的點子，在絕境中為團隊殺出一條血路。你是混亂中的智者，總能看見別人看不見的可能性。",
        "strengths": ["創新思維與腦力激盪", "極佳的適應力", "善於分析與辯論", "能看見別人看不見的可能性"],
        "weaknesses": ["容易半途而廢", "喜歡爭辯，惹人厭煩", "忽視細節與執行", "容易感到厭倦"],
        "career": {
            "zombie": "瘋狂科學家 / 詐欺師",
            "fantasy": "幻術師 / 發明家",
            "school": "辯論社社長 / 廣播社",
            "cyber": "黑客 / 非法改裝師"
        }
    },
    "ENFP": {
        "title": "競選者", "color": ["#00F260", "#0575E6"],
        "match": "INTJ", "clash": "ISTJ",
        "desc": "你是自由的靈魂，擁有無限的好奇心。末日的殘酷關不住你對探索的渴望。你熱情、友善，能在任何地方交到朋友（甚至可能感化敵人）。你相信萬物皆有連結，總是在尋找生命的意義。你的直覺很準，能發現隱藏的資源或路徑。雖然你常因為分心而惹麻煩，但你的熱情和創造力是團隊的催化劑，讓大家相信「未來」是存在的。你是那個會提議去尋找傳說中「沒有喪屍的島嶼」的人，並且真的帶大家找到了。",
        "strengths": ["熱情且富有想像力", "極佳的溝通能力", "適應力強，心態開放", "善於啟發他人"],
        "weaknesses": ["容易分心，缺乏專注", "情緒起伏大", "過度思考", "不喜歡處理細節"],
        "career": {
            "zombie": "探險家 / 記者",
            "fantasy": "德魯伊 / 召喚師",
            "school": "康輔社 / 轉學生",
            "cyber": "自由記者 / 革命家"
        }
    },
    "ISTP": {
        "title": "鑑賞家", "color": ["#4B79A1", "#283E51"],
        "match": "ESTJ", "clash": "ENFJ",
        "desc": "你是冷靜的技術大師，也是最高效的殺手。你話不多，喜歡用行動證明一切。你對機械、武器和工具的使用有著天賦般的直覺。在危機中，你是最冷靜的人，能瞬間分析局勢並做出最優解。你喜歡獨來獨往，不喜歡被團體束縛，但只要你認定了夥伴，你就是最可靠的後盾。你是那種能用一根迴紋針修好發電機，或者用一把刀解決所有問題的人。你是實用主義的極致。",
        "strengths": ["冷靜理智，危機處理強", "精通機械與工具", "極高的實用主義", "獨立且靈活"],
        "weaknesses": ["情感疏離，難以溝通", "容易冒險", "不喜歡承諾與束縛", "對抽象理論沒耐心"],
        "career": {
            "zombie": "機械維修師 / 獨行俠",
            "fantasy": "刺客 / 盜賊",
            "school": "工藝社 / 翹課王",
            "cyber": "武器專家 / 傭兵"
        }
    },
    "ISFP": {
        "title": "探險家", "color": ["#FC466B", "#3F5EFB"],
        "match": "ESFJ", "clash": "ENTJ",
        "desc": "你是廢墟中的藝術家，擁有最溫柔的靈魂。即使世界變得醜陋，你依然堅持尋找美與善良。你活在當下，感官敏銳，能注意到別人忽略的細節，比如廢墟中盛開的一朵花。你不喜歡衝突，也不喜歡控制別人，你只想按照自己的價值觀活著。在末日中，你的存在提醒了大家「人性」的可貴。雖然你看起來柔弱，但當你的底線被觸碰，或者你想保護的人受到威脅時，你會爆發出驚人的勇氣。",
        "strengths": ["極具藝術感與審美", "溫和且包容", "觀察力敏銳", "忠於自我價值觀"],
        "weaknesses": ["過於敏感，容易受傷", "缺乏長遠規劃", "不喜歡競爭與壓力", "難以預測"],
        "career": {
            "zombie": "戰地醫護 / 畫家",
            "fantasy": "馴獸師 / 精靈遊俠",
            "school": "美術社 / 樂團吉他手",
            "cyber": "街頭藝術家 / 義體醫生"
        }
    },
    "INTP": {
        "title": "邏輯學家", "color": ["#1c92d2", "#f2fcfe"],
        "match": "ENTJ", "clash": "ESFJ",
        "desc": "你是活在腦袋裡的哲學家。對你來說，喪屍病毒只是一個待解的謎題。你對社交不感興趣，但對世界的運作邏輯充滿好奇。你可能會冒險去抓一隻喪屍回來研究，只為了驗證你的理論。你擁有極強的邏輯分析能力，能看穿事物的本質。雖然你常因為發呆或過於抽象而被隊友吐槽，但往往是你能在絕境中找出意想不到的科學解決方案。你是那個能找出解藥，或者駭入防禦系統的人。",
        "strengths": ["極強的邏輯與分析力", "客觀且理性", "充滿創造性的解決方案", "思想開放"],
        "weaknesses": ["社交笨拙，情感疏離", "容易想太多而缺乏行動", "對規則感到不耐煩", "經常健忘"],
        "career": {
            "zombie": "病毒學家 / 研究員",
            "fantasy": "圖書館管理員 / 符文師",
            "school": "科研社 / 電競選手",
            "cyber": "密碼學家 / 網絡漫遊者"
        }
    },
    "INFP": {
        "title": "調停者", "color": ["#654ea3", "#eaafc8"],
        "match": "ENFJ", "clash": "ESTJ",
        "desc": "你是理想主義的詩人。這個殘酷的世界經常讓你感到心碎，但你從未放棄心中的光。你擁有深邃的內心世界和豐富的情感，能與他人的痛苦共鳴。在末日中，你是道德的指南針，提醒大家不要淪為野獸。雖然你看起來不擅長戰鬥，但你的信念強大到足以撼動人心。你是那個會在廢墟中種下一朵花，並相信它會開花的人。你是受傷的治癒者，是人類文明最後的溫柔火種。",
        "strengths": ["極強的同理心", "富有創意與想像力", "堅持理想與價值觀", "善於調解衝突"],
        "weaknesses": ["過於敏感與情緒化", "不切實際", "難以處理數據與細節", "容易自我批評"],
        "career": {
            "zombie": "作家 / 歷史記錄者",
            "fantasy": "牧師 / 魔法師",
            "school": "圖書委員 / 輔導室小幫手",
            "cyber": "虛擬實境設計師 / 心靈導師"
        }
    },
}
SORTING_QUIZ = [
    {
        "q": "1. 如果你獲得 10 億元且不需工作，你第一件事做什麼？",
        "opts": [
            ("去地圖上找不到的秘境探險", "fantasy"),
            ("買座堡壘囤積物資，確保絕對安全", "zombie"),
            ("包下遊樂園，找所有朋友開派對", "school"),
            ("投資尖端實驗室，親眼見證未來科技", "cyber")
        ]
    },
    {
        "q": "2. 世界末日還有 1 小時，你最後會做什麼？",
        "opts": [
            ("閉眼祈禱，希望能穿越到異世界", "fantasy"),
            ("衝去搶奪武器和食物，準備活下去", "zombie"),
            ("打電話給最愛的人說真心話", "school"),
            ("試圖駭入電腦尋找災難真相", "cyber")
        ]
    },
    {
        "q": "3. 瘋狂科學家給你一瓶藥水，你希望獲得？",
        "opts": [
            ("元素魔法 (控制風火水土)", "fantasy"),
            ("不死之身 (極限生存能力)", "zombie"),
            ("讀心術 (看穿人心)", "school"),
            ("超級大腦 (瞬間學會所有知識)", "cyber")
        ]
    },
    {
        "q": "4. 展開長途旅程，你最想要的夥伴是？",
        "opts": [
            ("一隻忠誠強大的傳說神獸", "fantasy"),
            ("身經百戰的特種兵", "zombie"),
            ("幽默風趣的好朋友", "school"),
            ("無所不知的 AI 機器人", "cyber")
        ]
    },
    {
        "q": "5. 週末想看電影，你會選哪種海報？",
        "opts": [
            ("巨龍與城堡的史詩冒險", "fantasy"),
            ("陰暗廢墟與危機的驚悚片", "zombie"),
            ("陽光下的校園青春戀愛劇", "school"),
            ("霓虹燈光與機械的科幻片", "cyber")
        ]
    }
]
ALL_QUIZZES = {
    # 暫時留空的奇幻篇
    "fantasy": [
        # --- Chapter 1: 召喚與覺醒 (Q1-Q5) ---
        {
            "q": "1. 你睜開眼，發現自己身處一個充滿魔法的異世界。你的第一個直覺反應是？",
            "opts": [
                # ISTJ/ISFJ (確認現狀)
                {"txt": "A. 檢查隨身物品，確認身體有無受傷，尋找水源和掩蔽物。(謹慎求生)", "scores": {"ISTJ": 3, "ISFJ": 2, "INTJ": 3, "ISTP": 2}},
                # ENTP/INTP (解析世界)
                {"txt": "B. 「這是哪裡？重力係數多少？有魔法嗎？」興奮地開始分析環境法則。(好奇心)", "scores": {"INTP": 3, "ENTP": 6, "ENFP": 4, "INTJ": 2}},
                # ESTP/ESFP (探索)
                {"txt": "C. 深吸一口氣，大喊一聲！然後直接往最近的城鎮衝去，先看了再說。(行動派)", "scores": {"ESTP": 6, "ESFP": 6, "ENFP": 3, "ISTP": 2}},
                # ENTJ/ESTJ (掌控)
                {"txt": "D. 迅速判斷自己的處境，尋找這個世界的權力中心或情報來源。(戰略規劃)", "scores": {"ENTJ": 6, "ESTJ": 2, "ENFJ": 6, "INTJ": 2}}
            ]
        },
        {
            "q": "2. 你面前出現了四把傳說武器，你要選擇哪一把作為你的初始裝備？",
            "opts": [
                # ENTJ/ESTJ (權力/正義)
                {"txt": "A. 【王者之劍】。象徵權力與統治，能號令千軍萬馬。(領袖)", "scores": {"ENTJ": 6, "ESTJ": 2, "ENFJ": 4, "ISTJ": 2}},
                # INFP/INFJ/ISFP (魔法/靈性)
                {"txt": "B. 【世界樹法杖】。蘊含古老的自然魔力，能治癒萬物與溝通精靈。(魔法)", "scores": {"INFP": 7, "INFJ": 3, "ISFP": 5, "ENFP": 2}},
                # ISTP/ESTP (技巧/速度)
                {"txt": "C. 【暗影雙匕】。輕盈致命，適合暗殺與高機動性的戰鬥。(刺客)", "scores": {"ISTP": 7, "ESTP": 6, "ISFP": 4, "ENTP": 2}},
                # ISFJ/ESFJ (守護)
                {"txt": "D. 【聖光埃吉斯盾】。堅不可摧，誓言守護身後的所有夥伴。(守護者)", "scores": {"ISFJ": 4, "ESFJ": 6, "ISTJ": 4, "ENFJ": 5}}
            ]
        },
        {
            "q": "3. 冒險者公會正在招募新人，你決定接下哪個任務？",
            "opts": [
                # ESTP/ESFP (名聲/錢)
                {"txt": "A. 討伐巨龍！報酬最高，而且能讓我的名字響徹整個大陸！(揚名立萬)", "scores": {"ESTP": 7, "ESFP": 7, "ENTJ": 4, "ENTP": 2}},
                # INTP/INTJ (知識)
                {"txt": "B. 探索古代遺跡。據說那裡藏著失落的魔法書和文明的真相。(探求真理)", "scores": {"INTP": 7, "INTJ": 3, "INFJ": 4, "ENTP": 3}},
                # ISFJ/ESFJ (助人)
                {"txt": "C. 護送商隊或幫助村民。雖然報酬普通，但能切實地幫助到需要的人。(行善)", "scores": {"ISFJ": 3, "ESFJ": 6, "ENFJ": 7, "INFP": 2}},
                # ISTP/ISFP (自由)
                {"txt": "D. 採集稀有藥草。可以獨自進入森林，享受安靜的狩獵時光。(自由自在)", "scores": {"ISFP": 7, "ISTP": 6, "INFP": 4, "ISTJ": 1}}
            ]
        },
        {
            "q": "4. 在森林裡，你遇到一隻受傷的魔獸幼崽，它看起來很有潛力但也很危險。你會？",
            "opts": [
                # ENTJ/INTJ (利用)
                {"txt": "A. 馴服它。如果能控制它，未來將會是強大的戰力。(工具化)", "scores": {"ENTJ": 3, "INTJ": 2, "ESTJ": 4, "ISTP": 2}},
                # INFP/ISFP (共情)
                {"txt": "B. 溫柔地幫它包紮，試著與它心靈感應。萬物皆有靈。(德魯伊)", "scores": {"INFP": 7, "ISFP": 7, "INFJ": 5, "ENFP": 3}},
                # ISTJ/ESTJ (排除風險)
                {"txt": "C. 殺了它或趕走它。這是魔獸，長大後會吃人，不能留隱患。(理性驅逐)", "scores": {"ISTJ": 3, "ESTJ": 2, "ISTP": 4, "INTJ": 2}},
                # ENFP/ESFP (寵物)
                {"txt": "D. 「好可愛！」偷偷養起來當寵物，給它取個可愛的名字。(好奇心)", "scores": {"ENFP": 6, "ESFP": 6, "ESFJ": 4, "ISFP": 2}}
            ]
        },
        {
            "q": "5. 旅途中經過一個被詛咒的村莊，村民請求你解開詛咒，但這需要代價。你會？",
            "opts": [
                # ENFJ/ESFJ (犧牲/責任)
                {"txt": "A. 義不容辭。身為勇者，拯救無辜是我的職責，代價我來扛。(英雄主義)", "scores": {"ENFJ": 7, "ESFJ": 6, "INFJ": 4, "ISFJ": 3}},
                # ENTP/INTP (解謎)
                {"txt": "B. 研究詛咒的結構。一定有不用付出代價也能破解的漏洞。(尋找Bug)", "scores": {"ENTP": 7, "INTP": 3, "INTJ": 4, "ISTP": 2}},
                # ISTJ/ESTJ (契約)
                {"txt": "C. 先談好報酬。我們可以幫忙，但這是契約，必須有相對的回報。(公事公辦)", "scores": {"ESTJ": 4, "ISTJ": 2, "ENTJ": 6, "INTJ": 2}},
                # ISFP/INFP (直覺/避世)
                {"txt": "D. 相信直覺。如果感覺邪惡氣息太重，我會選擇繞道離開。(趨吉避凶)", "scores": {"ISFP": 5, "INFP": 4, "ISTP": 3, "INFJ": 2}}
            ]
        },

        # --- Chapter 2: 團隊與魔法 (Q6-Q10) ---
        {
            "q": "6. 隊伍裡的魔法師和戰士因為戰術問題吵架了，你會怎麼做？",
            "opts": [
                # ESTJ/ENTJ (權威)
                {"txt": "A. 大聲喝斥：「閉嘴！現在我是隊長，聽我的指令行動！」(強制執行)", "scores": {"ESTJ": 7, "ENTJ": 6, "ISTJ": 1, "ISTP": 1}},
                # ENFJ/ESFJ (調解)
                {"txt": "B. 把兩人拉開，引導他們說出顧慮，找出雙方都能接受的方案。(和平主義)", "scores": {"ESFJ": 7, "ENFJ": 7, "INFJ": 4, "ISFJ": 2}},
                # ENTP/INTP (邏輯)
                {"txt": "C. 分析兩邊的數據。「根據魔力消耗和敵防禦率，法師的方案勝率高 15%。」(數據說話)", "scores": {"INTP": 3, "ENTP": 5, "INTJ": 4, "ISTP": 2}},
                # ISFP/INFP (迴避)
                {"txt": "D. 默默地在一旁保養武器或看風景，等他們吵完再叫我。(置身事外)", "scores": {"ISFP": 3, "INFP": 5, "ISTP": 4, "INTJ": 1}}
            ]
        },
        {
            "q": "7. 你們發現了一本記載著「禁忌黑魔法」的書，威力強大但會侵蝕心智。你會？",
            "opts": [
                # INTJ/ENTJ (力量)
                {"txt": "A. 學習它。力量本身沒有善惡，只要我意志夠強，就能駕馭它。(追求力量)", "scores": {"INTJ": 4, "ENTJ": 6, "ENTP": 4, "ISTP": 2}},
                # ISTJ/ISFJ (封印)
                {"txt": "B. 立刻封印或銷毀。這種危險的東西不該存在於世上。(守序)", "scores": {"ISTJ": 4, "ISFJ": 3, "ESTJ": 5, "ENFJ": 2}},
                # INTP/ENTP (好奇)
                {"txt": "C. 偷偷藏起來研究。這可是失傳的知識，不看太可惜了。(知識渴望)", "scores": {"INTP": 7, "ENTP": 6, "INFJ": 3, "INTJ": 2}},
                # INFP/ENFP (恐懼)
                {"txt": "D. 敬而遠之。感覺這本書散發著不詳的氣息，最好別碰。(直覺)", "scores": {"INFP": 6, "ENFP": 5, "ISFP": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "8. 進入地下城，眼前有四條路，你會建議走哪一條？",
            "opts": [
                # ENTJ/ESTP (風險)
                {"txt": "A. 最短、最危險的那條。高風險高回報，我們趕時間！(效率)", "scores": {"ENTJ": 3, "ESTP": 6, "ESFP": 4, "ISTP": 2}},
                # ISTJ/ISFJ (安全)
                {"txt": "B. 曾經有人走過、有地圖標記的那條。安全第一。(保守)", "scores": {"ISTJ": 3, "ISFJ": 3, "ESTJ": 4, "INTJ": 2}},
                # ENFP/ENTP (未知)
                {"txt": "C. 看起來最神秘、發著奇怪光芒的那條。感覺那邊有好玩的！(好奇)", "scores": {"ENFP": 7, "ENTP": 6, "INTP": 4, "ESFP": 2}},
                # INFJ/INTJ (直覺)
                {"txt": "D. 閉上眼感應氣流和魔力流動，選擇感覺最「對」的那條。(第六感)", "scores": {"INFJ": 7, "INTJ": 2, "INFP": 5, "ISFP": 3}}
            ]
        },
        {
            "q": "9. 隊伍經費不足了，為了賺錢，你會提議？",
            "opts": [
                # ESTP/ESFP (競技場)
                {"txt": "A. 去參加競技場格鬥大賽！贏了有獎金，還能出名。(戰鬥)", "scores": {"ESTP": 7, "ESFP": 7, "ISTP": 4, "ENTJ": 2}},
                # ISTJ/ESTJ (打工)
                {"txt": "B. 接幾個穩定的護送或送信任務，積少成多。(腳踏實地)", "scores": {"ISTJ": 4, "ESTJ": 6, "ISFJ": 2, "INTJ": 1}},
                # ENTP/ENFP (詐欺/表演)
                {"txt": "C. 在廣場表演魔法，或者用口才推銷一些「神奇藥水」。(街頭智慧)", "scores": {"ENTP": 7, "ENFP": 3, "ESFP": 5, "INTP": 2}},
                # ISFP/INFP (採集)
                {"txt": "D. 去森林採集稀有素材或製作工藝品拿去賣。(手藝)", "scores": {"ISFP": 4, "INFP": 6, "ISTP": 4, "ISFJ": 2}}
            ]
        },
        {
            "q": "10. 最終Boss前的守門人問了一個無解的哲學謎題，答錯會死。你會？",
            "opts": [
                # INTP/INTJ (解謎)
                {"txt": "A. 冷靜分析題目的邏輯漏洞，給出一個完美的悖論答案。(智力碾壓)", "scores": {"INTP": 7, "INTJ": 4, "ENTP": 5, "ISTP": 1}},
                # ENFJ/INFJ (感化)
                {"txt": "B. 不回答謎題，而是與守門人對話，試圖理解他的孤獨與執著。(心靈感化)", "scores": {"INFJ": 7, "ENFJ": 6, "INFP": 5, "ENFP": 2}},
                # ESTP/ISTP (暴力)
                {"txt": "C. 「太麻煩了！」趁他在唸題目的時候，直接拔刀砍過去。(物理破解)", "scores": {"ISTP": 7, "ESTP": 7, "ESFP": 4, "ENTJ": 2}},
                # ESFJ/ISFJ (誠實)
                {"txt": "D. 誠實地說「我不知道」，並請求他放行，展現真誠。(真誠)", "scores": {"ISFJ": 3, "ESFJ": 6, "ISTJ": 4, "INFP": 2}}
            ]
        },

        # --- Chapter 3: 王國與政治 (Q11-Q15) ---
        {
            "q": "11. 國王賞賜你一塊領地，你會如何治理？",
            "opts": [
                # ESTJ/ENTJ (法治)
                {"txt": "A. 建立嚴格的法律與稅收制度，擴充軍隊，打造最強堡壘。(軍事化)", "scores": {"ESTJ": 7, "ENTJ": 7, "ISTJ": 4, "INTJ": 2}},
                # ESFJ/ENFJ (福利)
                {"txt": "B. 建立學校和醫院，確保每個子民都吃得飽、穿得暖。(仁政)", "scores": {"ESFJ": 7, "ENFJ": 7, "ISFJ": 2, "INFP": 2}},
                # INTP/ENTP (科技)
                {"txt": "C. 引進異世界的科技與魔法，將它改造成一座未來都市。(改革)", "scores": {"ENTP": 7, "INTP": 7, "INTJ": 4, "ISTP": 2}},
                # ISFP/INFP (自然)
                {"txt": "D. 順其自然，與森林共存，建立一個像世外桃源般的村莊。(無為而治)", "scores": {"INFP": 7, "ISFP": 7, "INFJ": 4, "ENFP": 2}}
            ]
        },
        {
            "q": "12. 鄰國發動戰爭，敵軍壓境。身為將軍的你會採取什麼戰術？",
            "opts": [
                # ENTJ/INTJ (奇襲)
                {"txt": "A. 擒賊先擒王。派出精銳部隊斬首敵方將領，一舉瓦解士氣。(斬首行動)", "scores": {"ENTJ": 4, "INTJ": 4, "ESTP": 4, "ISTP": 2}},
                # ISTJ/ESTJ (防守)
                {"txt": "B. 堅壁清野。死守城池，消耗敵軍的糧草與耐心，等待反擊。(消耗戰)", "scores": {"ISTJ": 7, "ESTJ": 6, "ISFJ": 5, "INTJ": 2}},
                # ENFP/ENTP (混亂)
                {"txt": "C. 製造混亂。散布謠言、召喚魔物，讓敵軍內部自己亂起來。(心理戰)", "scores": {"ENTP": 4, "ENFP": 3, "INFJ": 4, "INTP": 2}},
                # ENFJ/ISFJ (守護)
                {"txt": "D. 親自站在城牆最前線，用演說激勵士兵，誓死保衛家園。(士氣戰)", "scores": {"ENFJ": 7, "ESFJ": 6, "ISFJ": 5, "ESTP": 2}}
            ]
        },
        {
            "q": "13. 宮廷舞會上，一位神秘的貴族向你搭訕，你覺得他的意圖是？",
            "opts": [
                # ESFP/ENFP (浪漫)
                {"txt": "A. 他一定是被我的魅力迷住了！這是開啟戀愛支線的節奏！(自信)", "scores": {"ESFP": 7, "ENFP": 4, "ESFJ": 4, "ISFP": 2}},
                # INTJ/ISTP (懷疑)
                {"txt": "B. 他想利用我。這背後一定有政治陰謀，我得小心應對。(警覺)", "scores": {"INTJ": 3, "ISTP": 6, "INTP": 4, "ISTJ": 2}},
                # INFJ/INFP (深意)
                {"txt": "C. 他看起來很孤獨。或許他只是想找個懂他的人聊聊。(同理)", "scores": {"INFJ": 7, "INFP": 6, "ISFJ": 4, "ENFJ": 2}},
                # ESTP/ENTP (情報)
                {"txt": "D. 管他想幹嘛，先跟他聊聊，套出一些皇室八卦或情報。(情報收集)", "scores": {"ENTP": 3, "ESTP": 6, "ENFJ": 3, "ESFP": 5}}
            ]
        },
        {
            "q": "14. 你發現國王其實是魔族偽裝的，但國家現在治理得很好。你會？",
            "opts": [
                # ISTJ/ESTJ (原則)
                {"txt": "A. 揭發他！非我族類，其心必異。魔族就是敵人，不能妥協。(正義)", "scores": {"ESTJ": 7, "ISTJ": 7, "ENFJ": 3, "ISFJ": 2}},
                # INTJ/INTP (實用)
                {"txt": "B. 保持沈默。只要國家繁榮，統治者是誰並不重要。(實用主義)", "scores": {"INTJ": 4, "INTP": 6, "ISTP": 5, "ENTJ": 3}},
                # ENTP/ESTP (勒索)
                {"txt": "C. 這是個好把柄！私下找他談判，換取巨大的利益或權力。(機會主義)", "scores": {"ENTP": 7, "ESTP": 6, "ENTJ": 4, "ESFP": 2}},
                # INFJ/ISFP (觀察)
                {"txt": "D. 觀察他的本性。如果他是善良的魔族，或許可以打破種族的隔閡？(理想)", "scores": {"INFJ": 7, "INFP": 3, "ISFP": 5, "ENFP": 2}}
            ]
        },
        {
            "q": "15. 傳說中的聖女邀請你加入教會，但要你放棄冒險者的自由。你會？",
            "opts": [
                # ISFJ/ESFJ (歸屬)
                {"txt": "A. 答應她。能為神服務是榮耀，而且教會福利好，生活穩定。(安定)", "scores": {"ISFJ": 7, "ESFJ": 7, "ISTJ": 4, "ENFJ": 2}},
                # ISTP/ISFP (拒絕)
                {"txt": "B. 果斷拒絕。我生來就是自由的風，沒人能束縛我。(自由)", "scores": {"ISTP": 7, "ISFP": 7, "ESTP": 5, "INFP": 3}},
                # ENTJ/INTJ (權力)
                {"txt": "C. 如果能讓我當上樞機主教，掌握教會權力，我就考慮。(野心)", "scores": {"ENTJ": 3, "INTJ": 2, "ESTJ": 4, "ENTP": 2}},
                # ENFP/ESFP (猶豫)
                {"txt": "D. 「能不能兼職？」我想幫忙，但我不想整天待在教堂裡祈禱。(討價還價)", "scores": {"ENFP": 6, "ESFP": 6, "ENTP": 4, "ISFP": 2}}
            ]
        },

        # --- Chapter 4: 命運的抉擇 (Q16-Q20) ---
        {
            "q": "16. 最終Boss竟然是你穿越前的摯友，他邀請你一起統治世界。你會？",
            "opts": [
                # INFJ/ENFJ (喚醒)
                {"txt": "A. 含淚試圖喚醒他。「這不是你！快想起來我們的約定！」(情感喚醒)", "scores": {"ENFJ": 4, "INFJ": 7, "INFP": 5, "ESFJ": 2}},
                # ESTJ/ISTJ (職責)
                {"txt": "B. 拔劍相向。既然你墮落了，我有責任親手結束你的罪惡。(大義滅親)", "scores": {"ESTJ": 6, "ISTJ": 6, "ENTJ": 4, "ISTP": 2}},
                # ENTP/INTJ (加入)
                {"txt": "C. 「聽起來不錯？」假裝加入，深入了解他的計畫，再看情況背刺或合作。(深謀遠慮)", "scores": {"ENTP": 3, "INTJ": 6, "INTP": 5, "ESTP": 2}},
                # ISFP/INFP (痛苦)
                {"txt": "D. 陷入崩潰，無法戰鬥。為什麼命運要這樣捉弄我們？(內心破碎)", "scores": {"INFP": 4, "ISFP": 7, "ISFJ": 4, "ESFP": 2}}
            ]
        },
        {
            "q": "17. 世界即將毀滅，唯一的救世方法是犧牲你的一半靈魂，你會變成沒有感情的空殼。你會？",
            "opts": [
                # ISTJ/ISFJ (犧牲)
                {"txt": "A. 我願意。如果我的犧牲能換來世界的和平，那很划算。(自我犧牲)", "scores": {"ISFJ": 7, "ISTJ": 7, "INFJ": 5, "ESFJ": 3}},
                # ESTP/ENTJ (拒絕)
                {"txt": "B. 開什麼玩笑！沒有感情還算活著嗎？我寧願用戰鬥賭一把！(抗爭)", "scores": {"ESTP": 7, "ENTJ": 6, "ISTP": 5, "ESFP": 3}},
                # INTP/INTJ (分析)
                {"txt": "C. 尋找替代方案。一定有不用犧牲靈魂也能拯救世界的方法。(尋找第三條路)", "scores": {"INTP": 7, "INTJ": 4, "ENTP": 5, "ENFP": 2}},
                # ISFP/ENFP (價值)
                {"txt": "D. 如果變成空殼，我就無法再愛人了。這比死更可怕。(情感至上)", "scores": {"ISFP": 7, "ENFP": 6, "INFP": 6, "ESFP": 3}}
            ]
        },
        {
            "q": "18. 你獲得了「許願聖杯」，但只能許一個願望。你會許？",
            "opts": [
                # ENTJ/ESTJ (秩序)
                {"txt": "A. 消除世上所有的紛爭與戰亂，建立永恆的和平帝國。(絕對秩序)", "scores": {"ENTJ": 7, "ESTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # ENFP/ESFP (快樂)
                {"txt": "B. 讓所有人都獲得幸福和吃不完的美食！(普世快樂)", "scores": {"ENFP": 3, "ESFP": 7, "ESFJ": 4, "ISFP": 2}},
                # INTP/ENTP (真理)
                {"txt": "C. 我想知道這個宇宙誕生的所有真相與奧秘。(全知全能)", "scores": {"INTP": 7, "ENTP": 6, "INTJ": 5, "ISTP": 2}},
                # ISFJ/INFJ (平凡)
                {"txt": "D. 讓一切回到災難發生前，大家都能過著平凡安穩的日子。(守護日常)", "scores": {"ISFJ": 7, "INFJ": 6, "ISTJ": 4, "ISFP": 2}}
            ]
        },
        {
            "q": "19. 你的隊友受了詛咒，變成了只會賣萌的小史萊姆，無法變回來。你會？",
            "opts": [
                # ESFP/ENFP (接受)
                {"txt": "A. 「天啊太可愛了！」把他抱在懷裡蹭，發誓會照顧他一輩子。(溺愛)", "scores": {"ESFP": 7, "ENFP": 7, "ISFP": 5, "ESFJ": 3}},
                # ISTJ/ESTJ (困擾)
                {"txt": "B. 嘆氣。這下戰力大減了，得重新調整隊伍配置。(現實考量)", "scores": {"ISTJ": 6, "ESTJ": 6, "INTJ": 4, "ISTP": 2}},
                # INTP/ENTP (實驗)
                {"txt": "C. 戳戳看。好奇他的身體構造，想研究史萊姆的生活習性。(好奇)", "scores": {"INTP": 3, "ENTP": 2, "ISTP": 4, "INTJ": 2}},
                # INFJ/ISFJ (守護)
                {"txt": "D. 雖然很遺憾，但我會保護他，不讓任何魔物欺負他。(責任)", "scores": {"ISFJ": 7, "INFJ": 3, "ENFJ": 4, "INFP": 2}}
            ]
        },
        {
            "q": "20. 通往原本世界的傳送門打開了，但一旦回去就再也回不來。你會？",
            "opts": [
                # ISTJ/ISFJ (歸鄉)
                {"txt": "A. 回去。那裡有我的家人、朋友和熟悉的網絡，那才是我的家。(現實歸屬)", "scores": {"ISTJ": 7, "ISFJ": 7, "ESTJ": 5, "ESFJ": 3}},
                # ENFP/ENTP (留戀)
                {"txt": "B. 留下。這個充滿魔法與冒險的世界才是我真正屬於的地方！(夢想之地)", "scores": {"ENFP": 7, "ENTP": 2, "ESFP": 5, "ISFP": 3}},
                # INTJ/ENTJ (征服)
                {"txt": "C. 留下。我在這裡已經建立了基業，回去只能當普通人，我不甘心。(權力留戀)", "scores": {"ENTJ": 4, "INTJ": 6, "ESTP": 1, "ISTP": 2}},
                # INFJ/INFP (抉擇)
                {"txt": "D. 在門口猶豫到最後一秒...這是我一生中最艱難的決定。(靈魂拉扯)", "scores": {"INFP": 4, "INFJ": 3, "ISFP": 4, "ENFJ": 2}}
            ]
        },

        # --- Chapter 5: 傳奇的終章 (Q21-Q25) ---
        {
            "q": "21. 你的冒險故事被寫成了書，書名會是？",
            "opts": [
                # ESTP/ISTP (強者)
                {"txt": "A. 《最強劍神：我如何用一把劍征服異世界》", "scores": {"ESTP": 7, "ISTP": 7, "ENTJ": 4, "ESFP": 2}},
                # INFP/INFJ (詩意)
                {"txt": "B. 《風與星辰之歌：一個靈魂的流浪手札》", "scores": {"INFP": 4, "INFJ": 4, "ISFP": 5, "ENFP": 2}},
                # ENTP/INTP (知識)
                {"txt": "C. 《異世界萬物解析：你所不知道的魔法原理》", "scores": {"INTP": 4, "ENTP": 3, "INTJ": 5, "ISTJ": 2}},
                # ESFJ/ISFJ (回憶)
                {"txt": "D. 《我們在一起的日子：致我最親愛的夥伴們》", "scores": {"ESFJ": 7, "ISFJ": 7, "ENFJ": 5, "ISFP": 2}}
            ]
        },
        {
            "q": "22. 多年後，你成為了傳說中的英雄。你隱居在哪裡？",
            "opts": [
                # INTJ/ISTJ (高塔)
                {"txt": "A. 漂浮在空中的法師塔，俯瞰世間，守護著禁忌知識。", "scores": {"INTJ": 7, "ISTJ": 5, "INTP": 4, "ENTJ": 2}},
                # ISFP/INFP (森林)
                {"txt": "B. 精靈之森深處的小樹屋，與動物為伍，不問世事。", "scores": {"ISFP": 7, "INFP": 4, "INFJ": 2, "ISTP": 2}},
                # ESFP/ENFP (酒館)
                {"txt": "C. 鬧區的一間小酒館老闆，每天聽著新冒險者的吹牛。", "scores": {"ESFP": 7, "ENFP": 6, "ESTP": 5, "ESFJ": 2}},
                # ESTJ/ENTJ (王宮)
                {"txt": "D. 我沒有隱居。我還在攝政王的位置上，忙著治理國家呢！", "scores": {"ESTJ": 7, "ENTJ": 7, "ENFJ": 4, "ISTJ": 2}}
            ]
        },
        {
            "q": "23. 臨終前，你把自己最強的武器交給了誰？",
            "opts": [
                # ISTP/ESTP (強者)
                {"txt": "A. 舉辦比武大會，交給最後贏得勝利的最強者。(實力傳承)", "scores": {"ISTP": 7, "ESTP": 7, "ENTJ": 4, "INTJ": 2}},
                # ENFJ/ESFJ (善良)
                {"txt": "B. 交給那個雖然弱小，但擁有一顆善良之心的少年。(精神傳承)", "scores": {"ENFJ": 7, "ESFJ": 6, "INFJ": 2, "INFP": 3}},
                # ISTJ/ISFJ (血脈)
                {"txt": "C. 交給我的孩子或弟子。這是家族的榮耀，不能外流。(血脈傳承)", "scores": {"ISTJ": 7, "ISFJ": 7, "ESTJ": 5, "ESFP": 1}},
                # ENTP/INTP (緣分)
                {"txt": "D. 隨便扔進湖裡或插在石頭上。等待有緣人自己去發現吧！(命運傳承)", "scores": {"ENTP": 3, "INTP": 6, "ENFP": 5, "ISFP": 2}}
            ]
        },
        {
            "q": "24. 如果能帶一樣異世界的東西回地球，你會帶？",
            "opts": [
                # ENFP/ESFP (寵物)
                {"txt": "A. 一顆龍蛋。我要在現代都市裡養龍！太酷了！", "scores": {"ENFP": 7, "ESFP": 7, "ENTP": 5, "ISTP": 2}},
                # ISFJ/INFJ (藥水)
                {"txt": "B. 萬靈藥。我想治好地球上親人的病痛。", "scores": {"ISFJ": 7, "INFJ": 4, "ESFJ": 5, "INFP": 2}},
                # ENTJ/ESTJ (金幣)
                {"txt": "C. 一袋魔法寶石。這價值連城，回去我就財富自由了。", "scores": {"ESTJ": 7, "ENTJ": 3, "ESTP": 5, "INTJ": 2}},
                # INTP/INTJ (書)
                {"txt": "D. 魔法原理書。我要用科學解析魔法，引發地球的科技革命。", "scores": {"INTP": 4, "INTJ": 7, "ENTP": 5, "ISTJ": 1}}
            ]
        },
        {
            "q": "25. 最後的問題：你覺得「魔法」的本質是什麼？",
            "opts": [
                # INFJ/INFP (心)
                {"txt": "A. 是「心」的力量。願望越強烈，魔法就越強大。", "scores": {"INFJ": 4, "INFP": 4, "ENFJ": 5, "ISFP": 2}},
                # INTP/INTJ (規律)
                {"txt": "B. 是「高維度的科學」。只是我們還沒解析出它的方程式。", "scores": {"INTJ": 7, "INTP": 4, "ENTP": 5, "ISTJ": 2}},
                # ESTP/ENTJ (工具)
                {"txt": "C. 是「力量」。它是用來征服、保護和改變現實的工具。", "scores": {"ENTJ": 4, "ESTP": 6, "ISTP": 5, "ESTJ": 2}},
                # ESFP/ENFP (奇蹟)
                {"txt": "D. 是「奇蹟」。是讓不可能變為可能的夢想之光。", "scores": {"ENFP": 7, "ESFP": 7, "ESFJ": 4, "ISFJ": 2}}
            ]
        }
    ],
    "zombie": [
        # --- Chapter 1: 崩壞的序曲 ---
        {
            "q": "1. 深夜警報大響，窗外火光沖天。你直覺世界變了，第一反應是？",
            "opts": [
                # ISTJ 大補血 (原本只有5，現在給7)，ISFJ 削弱 (5->3)
                {"txt": "A. 立刻鎖門，把浴缸放滿水，清點冰箱食物。做好長期死守的準備。", "scores": {"ISTJ": 7, "ISFJ": 3, "INTJ": 3, "INFJ": 2}},
                # ENTJ/ESTJ 微調
                {"txt": "B. 打給親友下達指令：「待在原地別動！」隨即開始規劃逃生路線。", "scores": {"ENTJ": 5, "ESTJ": 6, "ENFJ": 3, "ISTP": 2}},
                # ESTP/ISTP 微調
                {"txt": "C. 腎上腺素飆升！抄起球棒或菜刀，守在門口準備跟衝進來的東西輸贏。", "scores": {"ESTP": 6, "ISTP": 6, "ESFP": 4, "ENTP": 2}},
                # INTP/ENTP 削弱 (原本5->4)
                {"txt": "D. 衝去電腦前刷暗網和論壇，試圖在網路斷線前找出災難的源頭。", "scores": {"INTP": 4, "ENTP": 4, "ENFP": 3, "INTJ": 2}}
            ]
        },
        {
            "q": "2. 逃亡路上，一對受傷母女求你載她們，但你的油不夠了。你會？",
            "opts": [
                # ESFJ/ENFJ
                {"txt": "A. 「快上車！」就算死在半路，我也做不到見死不救。", "scores": {"ESFJ": 5, "ENFJ": 5, "ISFJ": 3, "ENFP": 3}},
                # ESTJ/ISTJ 補強
                {"txt": "B. 「抱歉。」理性告訴你載了就是一起死，踩下油門冷酷離開。", "scores": {"ESTJ": 5, "ISTJ": 6, "INTJ": 4, "ENTJ": 3}},
                # ENTP/ESTP 削弱 (6->5)
                {"txt": "C. 快速談判：「妳們有水或武器嗎？」把這當成一場生存交易。", "scores": {"ENTP": 5, "ESTP": 5, "ENTJ": 3, "ISTP": 2}},
                # INFP/ISFP
                {"txt": "D. 內心天人交戰，最後還是停了車，但恐懼讓你全身發抖，甚至哭著開車。", "scores": {"INFP": 7, "ISFP": 9, "INFJ": 4, "ISFJ": 2}}
            ]
        },
        {
            "q": "3. 躲進商場，裡面有四派倖存者，你本能想加入哪一群？",
            "opts": [
                # ESFP/ENFP 大補血
                {"txt": "A. 在頂樓開烤肉派對的那群。反正世界末日了，不如快樂地活在當下！", "scores": {"ESFP": 8, "ENFP": 7, "ESTP": 4, "ISFP": 3}},
                # ISTJ/ESTJ 補強
                {"txt": "B. 由退伍軍人領導，正在嚴格分配糧食和崗哨的那群。", "scores": {"ISTJ": 6, "ESTJ": 5, "ISFJ": 3, "ENTJ": 2}},
                # INFJ/INFP 補強
                {"txt": "C. 圍在一起禱告、分享故事，互相心靈慰藉的那群。", "scores": {"INFJ": 6, "INFP": 5, "ENFJ": 4, "ISFP": 2}},
                # INTP/ISTP 削弱 (5->4)
                {"txt": "D. 在五金區敲敲打打，試圖改裝發電機和無人機的那群怪人。", "scores": {"INTP": 4, "ISTP": 5, "ENTP": 4, "INTJ": 2}}
            ]
        },
        {
            "q": "4. 必須撤離了，眼前只有兩樣特殊裝備，你只能帶走一樣：",
            "opts": [
                # ESTP/ISTP
                {"txt": "A. 裝滿子彈的衝鋒槍。恐懼源於火力不足。", "scores": {"ESTP": 5, "ISTP": 5, "ENTJ": 3, "ESTJ": 2}},
                # ISFJ 削弱 (5->3), ESFJ 削弱 (5->4)
                {"txt": "B. 急救醫療箱。受傷感染比喪屍更絕望，這能救命。", "scores": {"ISFJ": 3, "ESFJ": 4, "INFJ": 3, "ENFJ": 2}},
                # ENTP/INTJ 削弱
                {"txt": "C. 還能聯網的衛星電話。情報和通訊是無價的。", "scores": {"ENTP": 4, "INTJ": 5, "INTP": 4, "ENTJ": 2}},
                # ISFP/ENFP
                {"txt": "D. 一台拍立得和日記本。如果人類滅亡，我要記錄下我們存在的痕跡。", "scores": {"ISFP": 9, "ENFP": 6, "INFP": 5, "INFJ": 3}}
            ]
        },
        {
            "q": "5. 獨自守夜時，望著廢墟中的星空，你腦中浮現的是？",
            "opts": [
                # INFJ 補強, INFP 正常
                {"txt": "A. 「這世界雖然殘酷，但此刻的星空卻美得令人心碎。」", "scores": {"INFJ": 10, "INFP": 6, "ISFP": 4, "ENFP": 2}},
                # INTP 削弱 (5->4)
                {"txt": "B. 「人類文明就像病毒一樣脆弱，這或許是地球的重啟機制。」", "scores": {"INTP": 4, "ENTJ": 5, "INTJ": 4, "ENTP": 2}},
                # ESTJ/ISTJ 補強
                {"txt": "C. 「明天得往北走 30 公里，中午前必須趕到水庫。」", "scores": {"ISTJ": 6, "ESTJ": 6, "ENTJ": 3, "ISTP": 2}},
                # ESFJ/ISFJ 正常
                {"txt": "D. 「不知道爸媽現在還好嗎？希望能再見他們一面。」", "scores": {"ESFJ": 5, "ISFJ": 5, "ENFJ": 4, "ESFP": 2}}
            ]
        },

        # --- Chapter 2: 旅途中的人性 ---
        {
            "q": "6. 隊醫被咬了手，哭著求你們砍斷他的手賭一把。你會？",
            "opts": [
                # ENTJ/ESTJ
                {"txt": "A. 二話不說揮刀砍下。猶豫就是害死他，這是唯一的邏輯。", "scores": {"ENTJ": 5, "ESTJ": 5, "ISTP": 4, "INTJ": 3}},
                # ENFJ/ESFJ
                {"txt": "B. 抱住他，遮住他的眼睛，一邊安撫一邊動手，試圖減少他的恐懼。", "scores": {"ENFJ": 5, "ESFJ": 5, "INFJ": 6, "ISFJ": 2}},
                # ISFP/INFP
                {"txt": "C. 顫抖著退後，把刀子遞給別人。「我做不到...這太殘忍了。」", "scores": {"ISFP": 6, "INFP": 6, "ISFJ": 6, "ESFP": 2}},
                # ENTP/ENFP 削弱 (6->5)
                {"txt": "D. 「等等！有沒有別的方法？」試圖尋找止血帶或其它可能，不想輕易致殘。", "scores": {"ENTP": 5, "ENFP": 6, "INTP": 3, "ESFP": 2}}
            ]
        },
        {
            "q": "7. 發現物資豐富的倉庫，但裡面已有一家人。為了活下去，你會？",
            "opts": [
                # ESTP/ISTP
                {"txt": "A. 這是末世，強者生存。武力驅逐他們，佔領這個地方。", "scores": {"ESTP": 6, "ISTP": 6, "ENTJ": 3, "ESTJ": 2}},
                # ENFJ/ENFP
                {"txt": "B. 「我們有武器，你們有物資，合作才能雙贏。」嘗試談判。", "scores": {"ENFJ": 5, "ENFP": 5, "ESFJ": 3, "INFJ": 2}},
                # ISTJ 補強 (5->7), ISFJ 削弱
                {"txt": "C. 風險太高，悄悄偷走一部分物資就離開，不驚動對方。", "scores": {"ISTJ": 7, "INTJ": 5, "INTP": 3, "ISFJ": 2}},
                # ENTP/INFJ
                {"txt": "D. 假裝是政府救援隊，騙取信任混進去，再伺機而動。", "scores": {"ENTP": 6, "INFJ": 5, "ENFJ": 2, "INTJ": 2}}
            ]
        },
        {
            "q": "8. 隊伍裡有個只會抱怨還偷吃的累贅，你忍無可忍，你會？",
            "opts": [
                # ESTJ/ENTJ
                {"txt": "A. 當眾揭穿：「下次再犯，我就把你扔出去餵喪屍。」", "scores": {"ESTJ": 6, "ENTJ": 5, "ISTP": 3, "ESTP": 2}},
                # INFJ/ENFJ
                {"txt": "B. 召集其他人開會，達成共識後，集體對他施壓或驅逐。", "scores": {"INFJ": 5, "ENFJ": 5, "ESFJ": 3, "INTJ": 2}},
                # ENTP/INTJ 削弱 (6->5)
                {"txt": "C. 這種人還有利用價值。用食物控制他，危險時讓他去當誘餌。", "scores": {"ENTP": 5, "INTJ": 5, "INTP": 4, "ENTJ": 1}},
                # ISFJ/ISFP
                {"txt": "D. 默默把自己的食物分一點出來補上，不想讓氣氛變得太僵。", "scores": {"ISFJ": 7, "ISFP": 5, "INFP": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "9. 在廢墟找到一台 MP3，你會放什麼歌來聽？",
            "opts": [
                # ESTP/ESFP
                {"txt": "A. 重金屬搖滾。讓憤怒和腎上腺素跟著節奏一起爆發！", "scores": {"ESTP": 7, "ESFP": 7, "ENTP": 4, "ISTP": 3}},
                # ISTJ 補強 (5->6), ISFJ 削弱 (5->3)
                {"txt": "B. 戰前的流行老歌。閉上眼，假裝世界還很正常。", "scores": {"ISTJ": 7, "ISFJ": 3, "ESFJ": 3, "ISFP": 2}},
                # INTJ/INTP
                {"txt": "C. 古典樂或純音樂。在廢墟中聽巴哈，有一種荒謬的莊嚴感。", "scores": {"INTJ": 5, "INTP": 5, "INFJ": 4, "ISTJ": 2}},
                # ENFP/ISFP
                {"txt": "D. 隨機播放。我不介意下一首是什麼，驚喜才有趣。", "scores": {"ENFP": 6, "ISFP": 6, "ESFP": 4, "ENTP": 2}}
            ]
        },
        {
            "q": "10. 地下道遭遇喪屍，不能開槍引爆瓦斯。你會？",
            "opts": [
                # ESTJ/ENTJ
                {"txt": "A. 指揮隊友形成盾牆，用推擠的方式把它們推開。", "scores": {"ESTJ": 5, "ENTJ": 5, "ISTJ": 3, "INTJ": 2}},
                # ISTP/ISFP
                {"txt": "B. 拔出開山刀，衝上去近身肉搏。安靜又致命。", "scores": {"ISTP": 7, "ISFP": 5, "ESTP": 4, "ESFP": 2}},
                # ENTP/ENFP 削弱 (5->4)
                {"txt": "C. 丟出發聲玩具引開它們，趁機溜過去。", "scores": {"ENTP": 4, "ENFP": 5, "INTP": 4, "ESFP": 2}},
                # ESFJ/ISFJ
                {"txt": "D. 「你們快走！」我製造聲響吸引它們注意，為大家爭取時間。", "scores": {"ESFJ": 6, "ISFJ": 6, "ENFJ": 4, "INFP": 2}}
            ]
        },

        # --- Chapter 3: 建立新秩序 ---
        {
            "q": "11. 基地建立，誰該當領導者？",
            "opts": [
                # ENTJ/ESTJ
                {"txt": "A. 我來。只有我能做出艱難的決定，帶領大家活下去。", "scores": {"ENTJ": 4, "ESTJ": 5, "ENFJ": 2, "INTJ": 2}},
                # ISTP/ESTP
                {"txt": "B. 誰最強誰當老大。不服來戰，拳頭硬的說了算。", "scores": {"ISTP": 7, "ESTP": 6, "ENTP": 3, "ESFP": 2}},
                # ENFJ/ESFJ
                {"txt": "C. 投票決定。領袖應該是大家都信任且喜歡的人。", "scores": {"ENFJ": 4, "ESFJ": 6, "ENFP": 4, "INFJ": 2}},
                # INTP/INFP 削弱 INTP (5->4)
                {"txt": "D. 誰當都好，別來管我就行。我只負責做好我自己的事。", "scores": {"INTP": 4, "INFP": 5, "ISFP": 4, "ISTP": 2}}
            ]
        },
        {
            "q": "12. 資源分配出現爭議，你提出的方案是？",
            "opts": [
                # ISFJ/ISFP
                {"txt": "A. 按人頭平均分配。不管強弱，每個人拿到的都一樣。", "scores": {"ISFJ": 5, "ISFP": 5, "ESFJ": 3, "INFP": 2}},
                # ESTJ/ENTJ
                {"txt": "B. 按貢獻分配。殺喪屍多的人吃肉，沒貢獻的人喝湯。", "scores": {"ESTJ": 5, "ENTJ": 5, "ISTP": 4, "INTJ": 2}},
                # ENTP/ESTP 削弱 ENTP (6->4)
                {"txt": "C. 建立內部市場。用勞動換點數，想買什麼自己決定。", "scores": {"ENTP": 4, "ESTP": 5, "INTP": 4, "ENFP": 2}},
                # INFJ/ENFJ
                {"txt": "D. 按需求分配。生病和懷孕的人優先，強者少吃一點沒關係。", "scores": {"INFJ": 6, "ENFJ": 5, "INFP": 4, "ESFJ": 3}}
            ]
        },
        {
            "q": "13. 孩子問：「為什麼還要活下去？」你會回答？",
            "opts": [
                # ESFJ/ENFJ
                {"txt": "A. 「為了彼此。只要我們還在一起，就有活下去的理由。」", "scores": {"ESFJ": 7, "ENFJ": 6, "ISFJ": 4, "ENFP": 2}},
                # ESFP/ENFP
                {"txt": "B. 「為了還沒吃到的美食、還沒看過的風景。活著就有好事發生！」", "scores": {"ESFP": 7, "ENFP": 7, "ESTP": 4, "ISFP": 2}},
                # ISTJ/ESTJ 補強
                {"txt": "C. 「因為這是責任。我們要活下去，把人類文明延續下去。」", "scores": {"ISTJ": 6, "ESTJ": 5, "ENTJ": 3, "INTJ": 2}},
                # INTJ/INTP
                {"txt": "D. 「或許沒有理由。我們就像薛西弗斯，在荒謬中尋找意義。」", "scores": {"INTJ": 6, "INTP": 6, "INFJ": 4, "ISTP": 2}}
            ]
        },
        {
            "q": "14. 基地擴建，你負責什麼工作？",
            "opts": [
                # ISTJ/ISFJ 補強 ISTJ (5->7), 削弱 ISFJ (5->3)
                {"txt": "A. 整理倉庫、盤點物資、種植蔬菜。確保後勤無憂。", "scores": {"ISTJ": 7, "ISFJ": 3, "ESFJ": 3, "ISFP": 2}},
                # INTP/ENTP
                {"txt": "B. 規劃陷阱區、改良防禦工事、設計逃生路線。", "scores": {"INTP": 5, "ENTP": 5, "INTJ": 3, "INFJ": 1}},
                # ISTP/ESTP
                {"txt": "C. 搬磚頭、築圍牆、外出巡邏。我喜歡流汗的感覺。", "scores": {"ISTP": 5, "ESTP": 5, "ISFP": 3, "ESFP": 2}},
                # ESTJ/ENTJ
                {"txt": "D. 當工頭。監督進度，確保每個人都在工作，沒有偷懶。", "scores": {"ESTJ": 5, "ENTJ": 5, "ENFJ": 3, "ISTJ": 1}}
            ]
        },
        {
            "q": "15. 慶祝活過一年，大家舉辦晚會。你會？",
            "opts": [
                # ESFP/ENFP
                {"txt": "A. 跳上桌子跳舞、帶動氣氛，我要讓每個人都嗨起來！", "scores": {"ESFP": 7, "ENFP": 6, "ESTP": 4, "ESFJ": 2}},
                # ISFP/INFP
                {"txt": "B. 用廢棄物做些裝飾品，或是安靜地在一旁彈吉他。", "scores": {"ISFP": 6, "INFP": 6, "INFJ": 3, "ISFJ": 2}},
                # ESFJ/ENFJ
                {"txt": "C. 忙著分發食物和飲料，確保每個人都有拿到東西吃。", "scores": {"ESFJ": 7, "ENFJ": 5, "ISFJ": 4, "ESTJ": 2}},
                # INTJ/ISTP
                {"txt": "D. 坐在角落喝一杯酒，看著大家狂歡，心裡思考著明天的計畫。", "scores": {"INTJ": 5, "ISTP": 5, "INTP": 2, "ENTJ": 2}}
            ]
        },

        # --- Chapter 4: 信任與背叛 ---
        {
            "q": "16. 你的愛人被感染且隱瞞你，發作前一刻你才發現。你會？",
            "opts": [
                # INFP/ISFP
                {"txt": "A. 崩潰大哭，抱著他直到最後一刻，甚至想跟他一起死。", "scores": {"INFP": 9, "ISFP": 10, "INFJ": 4, "ENFP": 2}},
                # INTP/ENTP
                {"txt": "B. 「為什麼不早說？如果有早點講，說不定還有救！」", "scores": {"INTP": 6, "ENTP": 5, "ISTP": 3, "ESTJ": 2}},
                # ENTJ/ESTJ
                {"txt": "C. 強忍悲傷，拿出槍。「我愛你，所以我不能讓你變成怪物。」砰。", "scores": {"ENTJ": 5, "ESTJ": 5, "INTJ": 4, "ISTP": 4}},
                # ESFJ/ENFJ
                {"txt": "D. 驚慌失措，大喊叫醫生、叫大家來幫忙，無法接受事實。", "scores": {"ESFJ": 7, "ENFJ": 6, "ESFP": 4, "ISFJ": 2}}
            ]
        },
        {
            "q": "17. 敵方要求交出科學家換取停戰，你會？",
            "opts": [
                # INTJ/ENTJ
                {"txt": "A. 絕對不行。科學家是未來的希望，交出他等於放棄未來。", "scores": {"INTJ": 6, "ENTJ": 5, "INTP": 4, "ISTJ": 2}},
                # ENFJ/INFP
                {"txt": "B. 絕對不行。我們不出賣夥伴，這是做人的底線。", "scores": {"ENFJ": 6, "INFP": 5, "ESFJ": 4, "ISFP": 2}},
                # ESTP/ENTP
                {"txt": "C. 假裝答應，在交易現場設下埋伏，把他們一網打盡。", "scores": {"ESTP": 6, "ENTP": 6, "ISTP": 4, "INTJ": 5}},
                # ISTJ 補強, ISFJ 削弱
                {"txt": "D. 猶豫...如果犧牲一個人能救全基地幾百人，這或許是必要的惡。", "scores": {"ISTJ": 7, "ESTJ": 5, "INTP": 3, "ISFJ": 2}}
            ]
        },
        {
            "q": "18. 發現高層用活人做實驗，你會？",
            "opts": [
                # ENFP/INFP
                {"txt": "A. 太噁心了！我不管理由是什麼，我要向所有人揭發真相！", "scores": {"ENFP": 6, "INFP": 6, "ESFP": 4, "ENFJ": 2}},
                # INTP/ENTP
                {"txt": "B. 潛入實驗室偷看數據。如果實驗真的有效...或許值得討論？", "scores": {"INTP": 6, "ENTP": 6, "INTJ": 4, "ISTP": 2}},
                # ENTJ/ESTJ
                {"txt": "C. 這是推翻他們的好機會。蒐集證據，發動政變，自己當老大。", "scores": {"ENTJ": 6, "ESTJ": 5, "INTJ": 3, "ISTP": 4}},
                # ISFJ/ISTJ 削弱 ISFJ (6->4)
                {"txt": "D. 假裝不知道。我只想活下去，不想捲入這種危險的政治鬥爭。", "scores": {"ISFJ": 4, "ISTJ": 5, "ISFP": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "19. 直升機只能載走 4 個人，基地即將毀滅。你會？",
            "opts": [
                # ESTP/ESFP
                {"txt": "A. 衝上去搶位子！人不為己天誅地滅，我要活下去！", "scores": {"ESTP": 6, "ESFP": 6, "ENTJ": 3, "ISTP": 4}},
                # INFJ/ENFJ
                {"txt": "B. 讓給更有需要的人（小孩、醫生）。我留下來斷後。", "scores": {"INFJ": 8, "ENFJ": 6, "ISFJ": 4, "INFP": 2}},
                # ENTP/INTP
                {"txt": "C. 「誰說只能載 4 個？」把椅子拆了、丟掉重物，試圖塞進更多人。", "scores": {"ENTP": 6, "INTP": 5, "ENFP": 5, "ESTP": 2}},
                # ISTJ/ISFJ
                {"txt": "D. 我不走。這裡是我的家，我要戰鬥到最後一刻。", "scores": {"ISTJ": 6, "ISFJ": 6, "ESTJ": 4, "INTJ": 2}}
            ]
        },
        {
            "q": "20. 最後一刻，你拿到了一顆核彈的引爆器。引爆會炸死所有喪屍，但也會炸死你自己。你會？",
            "opts": [
                # INTJ/INFJ
                {"txt": "A. 按下按鈕。「為了人類的未來，這一點代價是值得的。」", "scores": {"INTJ": 6, "INFJ": 8, "ENTJ": 4, "INTP": 2}},
                # ISFP/INFP
                {"txt": "B. 猶豫...我看著身邊愛人的臉，我捨不得死，也捨不得他死。", "scores": {"ISFP": 6, "INFP": 6, "ESFP": 6, "ENFP": 1}},
                # INTP/ISTP
                {"txt": "C. 不按。炸了真的有用嗎？搞不好病毒早就變異了。", "scores": {"INTP": 4, "ISTP": 8, "ENTP": 4, "INTJ": 2}},
                # ESFJ/ISFJ
                {"txt": "D. 如果這能保護我的家人不再受苦，我會笑著按下它。", "scores": {"ESFJ": 8, "ISFJ": 6, "ENFJ": 4, "ISFP": 2}}
            ]
        },

        # --- Chapter 5: 結局與遺產 (Q21-Q25) ---
        {
            "q": "21. 最終，你活下來了。你覺得自己能活下來的最大原因是？",
            "opts": [
                # ISTJ 補強
                {"txt": "A. 因為我夠小心，從不冒險，步步為營。(謹慎)", "scores": {"ISTJ": 6, "ISFJ": 5, "ESTJ": 3, "INTJ": 1}},
                # ESTP/ESFP
                {"txt": "B. 因為我適應力強，不管環境多爛，我都能找到樂子。(適應)", "scores": {"ESTP": 5, "ESFP": 8, "ISTP": 3, "ENTP": 1}},
                # ENFP/INFP
                {"txt": "C. 因為我有信念，我相信明天會更好，這股力量支撐著我。(信念)", "scores": {"ENFP": 9, "INFP": 5, "ENFJ": 4, "INFJ": 1}},
                # ENTJ/INTP
                {"txt": "D. 因為我用腦子。暴力不能解決問題，智慧才能。(智慧)", "scores": {"ENTJ": 5, "INTP": 3, "INTJ": 4, "ENTP": 2}}
            ]
        },
        {
            "q": "22. 戰後世界，你選擇在哪裡定居？",
            "opts": [
                # ESFP/ESTP
                {"txt": "A. 重建後的都市。我喜歡熱鬧，喜歡人多的地方。(繁華)", "scores": {"ESFP": 8, "ESTP": 5, "ESFJ": 4, "ENFP": 2}},
                # INFP/ISFP
                {"txt": "B. 森林裡的小木屋。遠離人群，與大自然為伍，療癒創傷。(隱逸)", "scores": {"INFP": 6, "ISFP": 6, "INFJ": 4, "INTP": 2}},
                # INTJ/ENTP
                {"txt": "C. 高科技的研究中心。繼續探索科學，預防下一次災難。(進步)", "scores": {"INTJ": 5, "ENTP": 5, "INTP": 4, "ENTJ": 2}},
                # ISFJ/ISTJ 削弱 ISFJ (6->4)
                {"txt": "D. 回到我的故鄉。修復老房子，過著跟以前一樣的平靜生活。(歸根)", "scores": {"ISFJ": 4, "ISTJ": 6, "ESFJ": 4, "ISFP": 2}}
            ]
        },
        {
            "q": "23. 新世界的學校邀請你去演講，你會告訴孩子們什麼？",
            "opts": [
                # ENTJ/ESTJ
                {"txt": "A. 「世界是殘酷的，只有變強才不會被淘汰。」(生存法則)", "scores": {"ENTJ": 6, "ESTJ": 5, "INTJ": 3, "ESTP": 2}},
                # ENFJ/INFP
                {"txt": "B. 「愛與善良是我們與怪物唯一的區別，永遠不要遺失它。」(人性)", "scores": {"ENFJ": 6, "INFP": 5, "INFJ": 4, "ISFP": 2}},
                # ESFP/ESTP
                {"txt": "C. 「人生苦短，想做什麼就去做吧，別讓自己後悔！」(自由)", "scores": {"ESFP": 8, "ESTP": 6, "ENFP": 4, "ENTP": 2}},
                # ISTJ/ISFJ 補強 ISTJ
                {"txt": "D. 「記住這段歷史，承擔起重建文明的責任。」(傳承)", "scores": {"ISTJ": 7, "ISFJ": 5, "ESFJ": 4, "INTJ": 1}}
            ]
        },
        {
            "q": "24. 你在自己的墓碑上刻了一句話，那是？",
            "opts": [
                # INTP/ISTP
                {"txt": "A. 什麼都不刻，或者只刻一個名字。死後一切皆空。(虛無)", "scores": {"INTP": 6, "ISTP": 6, "INTJ": 4, "ENTP": 2}},
                # ENTP/ENFP
                {"txt": "B. 「我先去探路了，你們晚點再來！」(幽默)", "scores": {"ENTP": 5, "ENFP": 9, "ESFP": 6, "ESTP": 2}},
                # ESFJ/ISFJ 削弱 ISFJ (5->3)
                {"txt": "C. 「一位慈愛的父親/母親/朋友，長眠於此。」(關係)", "scores": {"ESFJ": 7, "ISFJ": 3, "ENFJ": 3, "ISFP": 1}},
                # ENTJ/ESTJ
                {"txt": "D. 「他/她重建了這座城市。」(成就)", "scores": {"ENTJ": 6, "ESTJ": 5, "INTJ": 3, "ISTJ": 2}}
            ]
        },
        {
            "q": "25. 故事結束了。這場喪屍浩劫對你來說，究竟是什麼？",
            "opts": [
                # INFJ/INFP
                {"txt": "A. 一場靈魂的洗禮。它毀了世界，卻讓我找到了真實的自己。(覺醒)", "scores": {"INFJ": 7, "INFP": 6, "ENFJ": 4, "ISFP": 2}},
                # ISTJ/ISFJ
                {"txt": "B. 一場徹頭徹尾的悲劇。我們失去了太多，沒有什麼值得慶祝的。(悲傷)", "scores": {"ISTJ": 6, "ISFJ": 6, "ESTJ": 4, "ESFJ": 2}},
                # ESTP/ESFP
                {"txt": "C. 一場瘋狂的冒險。雖然危險，但比以前無聊的日子刺激多了。(刺激)", "scores": {"ESTP": 7, "ESFP": 7, "ENTP": 4, "ISTP": 2}},
                # INTP/INTJ
                {"txt": "D. 一個巨大的實驗。它證明了人類的極限與脆弱。(觀察)", "scores": {"INTP": 6, "INTJ": 6, "ENTJ": 4, "ENTP": 2}}
            ]
        }
    ],
    "school": [
        # ==========================================
        # Chapter 1: 新學期 (Set A, B, C, D 輪替)
        # ==========================================
        {
            "q": "1. [開學] 走進鬧哄哄的教室，你的第一個直覺動作？",
            "opts": [
                # Set B (社交組)
                {"txt": "A. 熱情地跟每個人打招呼，然後找朋友聊天。", "scores": {"ESFJ": 7, "ENFJ": 6, "ISFJ": 4, "INFJ": 2}},
                # Set A (觀察組)
                {"txt": "B. 走到最後一排靠窗的位子，戴上耳機觀察全班。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # Set C (焦點組)
                {"txt": "C. 大聲推開門：「各位！我回來了！」瞬間成為焦點。", "scores": {"ESTP": 7, "ESFP": 6, "ENTP": 4, "ENFP": 2}},
                # Set D (隱形組)
                {"txt": "D. 低頭快步走到角落，希望不要被老師點名。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}}
            ]
        },
        {
            "q": "2. [選幹部] 沒人自願當班長，氣氛尷尬。你會？",
            "opts": [
                # Set A (掌控組) - 輪替分數: ESTJ升, INTJ降
                {"txt": "A. 「既然沒人要當，那就我來吧。」受不了效率低落。", "scores": {"ESTJ": 7, "ENTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # Set C (搞事組) - 輪替分數
                {"txt": "B. 舉手提名班上最安靜或最搞怪的人，想看好戲。", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # Set B (責任組) - 輪替分數
                {"txt": "C. 看老師很困擾，勉強舉手。不想讓場面難看。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}},
                # Set D (裝死組) - 輪替分數
                {"txt": "D. 絕對不與老師對上眼，心裡默唸「選不到我」。", "scores": {"ISTP": 7, "INTP": 6, "INFP": 4, "ISFP": 2}}
            ]
        },
        {
            "q": "3. [社團] 社團博覽會，你想加入哪裡？",
            "opts": [
                # Set C (舞台組) - ESFP升
                {"txt": "A. 熱舞社或籃球隊。在舞台上發光發熱！", "scores": {"ESFP": 7, "ESTP": 6, "ENFP": 4, "ENTP": 2}},
                # Set D (技術組) - INTP升
                {"txt": "B. 科研社或程式設計。學技術，不用太多社交。", "scores": {"INTP": 7, "ISTP": 6, "ISFP": 4, "INFP": 2}},
                # Set A (權力組) - ENTJ升
                {"txt": "C. 學生會或辯論社。參與決策，掌握資源。", "scores": {"ENTJ": 7, "ESTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # Set B (文藝組) - INFJ升
                {"txt": "D. 文學社或志工社。安靜地創作或幫助他人。", "scores": {"INFJ": 7, "ISFJ": 6, "ENFJ": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "4. [作業] 死黨忘記寫作業求你借他抄。你會？",
            "opts": [
                # Set C (靈活組) - ENFP升
                {"txt": "A. 「我們一起去圖書館趕工吧！我教你寫。」", "scores": {"ENFP": 7, "ENTP": 6, "ESFP": 4, "ESTP": 2}},
                # Set A (原則組) - ISTJ升
                {"txt": "B. 「不行。抄襲是害了你，你自己寫。」", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # Set D (包庇組) - ISFP升
                {"txt": "C. 裝傻到底。「我不知道，我當時在看書。」", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}},
                # Set B (好人組) - ENFJ升
                {"txt": "D. 「拿去吧，但要把字跡改一下喔。」", "scores": {"ENFJ": 7, "ESFJ": 6, "ISFJ": 4, "INFJ": 2}}
            ]
        },
        {
            "q": "5. [放學] 夕陽西下，這段時間你通常在做什麼？",
            "opts": [
                # Set D (獨處組) - 輪迴開始
                {"txt": "A. 一個人騎著單車閒晃，或是躲在祕密基地發呆。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}},
                # Set C (玩樂組)
                {"txt": "B. 揪團去唱 KTV、逛街，玩到天黑才回家。", "scores": {"ESTP": 7, "ESFP": 6, "ENTP": 4, "ENFP": 2}},
                # Set A (進修組)
                {"txt": "C. 去補習班或圖書館。現在努力是為了未來。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # Set B (照顧組)
                {"txt": "D. 留在學校幫忙社團善後，或聽朋友訴苦。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}}
            ]
        },

        # ==========================================
        # Chapter 2: 競爭與考驗 (分數繼續輪替)
        # ==========================================
        {
            "q": "6. [考試] 期末考大魔王來襲，你的策略是？",
            "opts": [
                # Set B (計畫組)
                {"txt": "A. 一個月前就擬定計畫表，按部就班地複習。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}},
                # Set C (爆發組)
                {"txt": "B. 前一天熬夜喝紅牛，靠短期記憶力爆發。", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # Set D (分析組)
                {"txt": "C. 分析出題邏輯，只讀會考的重點，追求CP值。", "scores": {"INTP": 7, "ISTP": 6, "INFP": 4, "ISFP": 2}},
                # Set A (互助組 - 這裡借用A組當讀書會長)
                {"txt": "D. 組織讀書會，分配大家負責的章節，互相教學。", "scores": {"ESTJ": 7, "ENTJ": 6, "ISTJ": 4, "INTJ": 2}}
            ]
        },
        {
            "q": "7. [比賽] 籃球賽落後一分，剩 10 秒。你會？",
            "opts": [
                # Set C (英雄組)
                {"txt": "A. 「球給我！」不管三七二十一，強行切入得分。", "scores": {"ESFP": 7, "ESTP": 6, "ENFP": 4, "ENTP": 2}},
                # Set A (戰術組)
                {"txt": "B. 喊暫停！畫出戰術，指揮隊友跑位。", "scores": {"ENTJ": 7, "ESTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # Set B (激勵組)
                {"txt": "C. 大聲為隊友加油，相信默契，輸了也要精彩。", "scores": {"ENFJ": 7, "ESFJ": 6, "ISFJ": 4, "INFJ": 2}},
                # Set D (洞察組)
                {"txt": "D. 默默跑到沒人注意的角落，等待關鍵傳球。", "scores": {"ISTP": 7, "INTP": 6, "ISFP": 4, "INFP": 2}}
            ]
        },
        {
            "q": "8. [作弊] 好友作弊被抓，老師問你有沒有看到。你會？",
            "opts": [
                # Set D (裝傻組)
                {"txt": "A. 裝傻到底。「我不知道，我在看書。」不出賣朋友。", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}},
                # Set A (正直組)
                {"txt": "B. 誠實回答。作弊就是不對，包庇是害了他。", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # Set C (詭辯組)
                {"txt": "C. 「老師，作弊的定義是什麼？」試圖把場面搞混。", "scores": {"ENFP": 7, "ENTP": 6, "ESFP": 4, "ESTP": 2}},
                # Set B (求情組)
                {"txt": "D. 私下找老師求情，希望給他改過機會。", "scores": {"INFJ": 7, "ISFJ": 6, "ENFJ": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "9. [園遊會] 班上要擺攤，你提議做什麼？",
            "opts": [
                # Set C (娛樂組)
                {"txt": "A. 恐怖鬼屋！我們可以扮鬼嚇人，這絕對最好玩！", "scores": {"ESTP": 7, "ESFP": 6, "ENTP": 4, "ENFP": 2}},
                # Set A (營利組)
                {"txt": "B. 低成本高利潤的小吃攤。目標是營業額第一！", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # Set D (氛圍組)
                {"txt": "C. 文青咖啡廳。佈置得很漂亮，播放舒服的音樂。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}},
                # Set B (服務組)
                {"txt": "D. 義賣二手市集。把賺到的錢捐給流浪動物之家。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}}
            ]
        },
        {
            "q": "10. [怪談] 傳說舊校舍晚上有怪聲。你會？",
            "opts": [
                # Set C (冒險組)
                {"txt": "A. 「太酷了！」今晚就揪團去夜遊探險，還要開直播！", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # Set A (守規組)
                {"txt": "B. 無聊的怪談。那是違反校規的，回家睡覺。", "scores": {"ESTJ": 7, "ENTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # Set D (求證組)
                {"txt": "C. 帶著儀器去測量。我想知道怪聲的物理成因。", "scores": {"INTP": 7, "ISTP": 6, "INFP": 4, "ISFP": 2}},
                # Set B (靈性組)
                {"txt": "D. 有點害怕，但又覺得那裡可能有悲傷的故事...遠遠祈禱。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}}
            ]
        },

        # ==========================================
        # Chapter 3: 青春與戀愛
        # ==========================================
        {
            "q": "11. [心動] 隔壁班的校草/校花似乎在看你，你的反應？",
            "opts": [
                # Set C (幻想組)
                {"txt": "A. 「天啊！戀愛預感！連孩子的名字都想好了！」", "scores": {"ESFP": 7, "ESTP": 6, "ENFP": 4, "ENTP": 2}},
                # Set A (理性組)
                {"txt": "B. 「他可能是在看我後面的時鐘。」繼續做自己的事。", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # Set D (害羞組)
                {"txt": "C. 臉紅心跳，假裝沒看到趕快低頭，心裡小鹿亂撞。", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}},
                # Set B (溫柔組 - 這裡稍微調整，讓ENFJ主動)
                {"txt": "D. 微笑回應對方的視線，展現友善的一面。", "scores": {"ENFJ": 7, "ESFJ": 6, "ISFJ": 4, "INFJ": 2}}
            ]
        },
        {
            "q": "12. [告白] 你要告白了，會選擇什麼方式？",
            "opts": [
                # Set D (深情組)
                {"txt": "A. 寫一封文情並茂的手寫信，偷偷塞在他的抽屜裡。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}},
                # Set C (公開組)
                {"txt": "B. 在全校面前大聲告白！讓全世界知道我愛他。", "scores": {"ENFP": 7, "ENTP": 6, "ESFP": 4, "ESTP": 2}},
                # Set A (務實組)
                {"txt": "C. 直接約出來講清楚。「我喜歡你，要不要在一起？」", "scores": {"ENTJ": 7, "ESTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # Set B (儀式組)
                {"txt": "D. 精心策劃一場完美的約會，在氣氛最好時說出口。", "scores": {"INFJ": 7, "ISFJ": 6, "ENFJ": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "13. [失戀] 好友失戀哭得很慘，你怎麼安慰？",
            "opts": [
                # Set B (共情組)
                {"txt": "A. 抱著他一起哭，罵那個渣男/渣女，陪他聊通宵。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}},
                # Set C (轉移組)
                {"txt": "B. 「別哭了！走，帶你去吃好吃的，再去唱KTV發洩！」", "scores": {"ESTP": 7, "ESFP": 6, "ENTP": 4, "ENFP": 2}},
                # Set A (解決組)
                {"txt": "C. 冷靜分析這段感情失敗的原因，告訴他下一個會更好。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # Set D (陪伴組)
                {"txt": "D. 什麼都不說，只是靜靜地陪在他身邊，遞給他衛生紙。", "scores": {"ISTP": 7, "INTP": 6, "ISFP": 4, "INFP": 2}}
            ]
        },
        {
            "q": "14. [謠言] 學校流傳關於你的不實謠言，你會？",
            "opts": [
                # Set A (反擊組)
                {"txt": "A. 正面迎擊！找出散布謠言的人，要求他公開道歉。", "scores": {"ESTJ": 7, "ENTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # Set D (受傷組)
                {"txt": "B. 覺得很受傷，躲起來不想見人，希望謠言自己消失。", "scores": {"INTP": 7, "ISTP": 6, "INFP": 4, "ISFP": 2}},
                # Set C (幽默組)
                {"txt": "C. 把謠言編成笑話自嘲，甚至加油添醋讓它更荒謬。", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # Set B (清者自清)
                {"txt": "D. 相信朋友會懂我。只要我在乎的人相信我就好。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}}
            ]
        },
        {
            "q": "15. [畢旅] 畢業旅行分房，你最在意的是？",
            "opts": [
                # Set B (人際組)
                {"txt": "A. 大家都能跟好朋友分在一起，沒有人落單被排擠。", "scores": {"ENFJ": 7, "ESFJ": 6, "ISFJ": 4, "INFJ": 2}},
                # Set C (好玩組)
                {"txt": "B. 我要跟最瘋的那群人一組，晚上打枕頭戰、玩通宵！", "scores": {"ESFP": 7, "ESTP": 6, "ENFP": 4, "ENTP": 2}},
                # Set A (安靜組)
                {"txt": "C. 室友不要打呼磨牙，作息要正常，我想好好睡覺。", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # Set D (隨意組)
                {"txt": "D. 跟誰都可以，只要給我一個角落讓我安靜滑手機。", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}}
            ]
        },

        # ==========================================
        # Chapter 4: 衝突與抉擇
        # ==========================================
        {
            "q": "16. [冤枉] 老師冤枉全班吵鬧要罰站，你會？",
            "opts": [
                # Set C (抗議組)
                {"txt": "A. 舉手抗議：「老師，這不公平！為什麼沒吵的人也要受罰？」", "scores": {"ENFP": 7, "ENTP": 6, "ESFP": 4, "ESTP": 2}},
                # Set A (服從組)
                {"txt": "B. 嘆口氣，乖乖站好。反抗也沒用，趕快罰完趕快回家。", "scores": {"ENTJ": 7, "ESTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # Set B (溝通組)
                {"txt": "C. 代表全班去跟老師溝通，試圖達成一個雙方都能接受的妥協。", "scores": {"INFJ": 7, "ISFJ": 6, "ENFJ": 4, "ESFJ": 2}},
                # Set D (偷溜組)
                {"txt": "D. 趁老師轉身寫黑板的時候，從後門溜之大吉。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}}
            ]
        },
        {
            "q": "17. [經費] 社團經費被砍，面臨倒社，你會？",
            "opts": [
                # Set A (爭取組)
                {"txt": "A. 整理出年度成果報告，直接找校長談判，據理力爭。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # Set C (募款組)
                {"txt": "B. 發起校園募款！舉辦義賣或表演，靠自己賺回來。", "scores": {"ESTP": 7, "ESFP": 6, "ENFP": 4, "ENTP": 2}},
                # Set D (鑽洞組 - 這裡借用 INTP 的聰明)
                {"txt": "C. 研究法規漏洞，掛名在其他社團下生存。", "scores": {"ISTP": 7, "INTP": 6, "ISFP": 4, "INFP": 2}},
                # Set B (團結組)
                {"txt": "D. 沒錢就沒錢吧。只要大家心在一起，哪裡都能練習。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}}
            ]
        },
        {
            "q": "18. [筆記] 對手偷走你的比賽筆記，你會？",
            "opts": [
                # Set A (實力組)
                {"txt": "A. 沒關係。我的實力在腦子裡，偷走筆記也偷不走冠軍。", "scores": {"ESTJ": 7, "ENTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # Set D (隱忍組)
                {"txt": "B. 雖然很難過，但不想把事情鬧大，只好熬夜重做。", "scores": {"INTP": 7, "ISTP": 6, "INFP": 4, "ISFP": 2}},
                # Set C (報復組)
                {"txt": "C. 以牙還牙！我也去偷他的，或者在他的鞋子裡放圖釘。", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # Set B (原諒組 - 雖然很氣但還是選擇原諒)
                {"txt": "D. 相信他有苦衷，甚至主動問他是不是需要幫忙。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}}
            ]
        },
        {
            "q": "19. [話劇] 全班演話劇，你想擔任什麼角色？",
            "opts": [
                # Set B (主角組)
                {"txt": "A. 導演或主角。我要帶領大家完成這齣大戲！", "scores": {"ENFJ": 7, "ESFJ": 6, "ISFJ": 4, "INFJ": 2}},
                # Set D (幕後組)
                {"txt": "B. 編劇或道具組。躲在幕後發揮創意，不想上台。", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}},
                # Set C (配角組)
                {"txt": "C. 搞笑的配角。只要能逗大家笑，戲份多少不重要。", "scores": {"ESFP": 7, "ESTP": 6, "ENTP": 4, "ENFP": 2}},
                # Set A (音控組)
                {"txt": "D. 音控或燈光。這需要精準技術，且不用跟人講話。", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}}
            ]
        },
        {
            "q": "20. [膠囊] 畢業埋時光膠囊，你放什麼？",
            "opts": [
                # Set D (初心組)
                {"txt": "A. 寫給未來自己的一封信，寫滿夢想與期許。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}},
                # Set B (回憶組)
                {"txt": "B. 全班的大合照與簽名制服。這是友誼的證明。", "scores": {"INFJ": 7, "ISFJ": 6, "ESFJ": 4, "ENFJ": 2}},
                # Set A (預測組)
                {"txt": "C. 對十年後科技或股價的預測。想驗證自己準不準。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # Set C (價值組)
                {"txt": "D. 我現在最喜歡的遊戲機或限量球鞋。以後會增值！", "scores": {"ENTP": 7, "ENFP": 6, "ESFP": 4, "ESTP": 2}}
            ]
        },

        # ==========================================
        # Chapter 5: 青春的終章
        # ==========================================
        {
            "q": "21. [畢業] 典禮當天，你的真實感受？",
            "opts": [
                # Set B (捨不得)
                {"txt": "A. 哭成淚人兒。真的捨不得大家，希望時間能停在這一刻。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}},
                # Set C (解脫)
                {"txt": "B. 「終於解脫了！」迫不及待迎接自由的大學生活。", "scores": {"ESTP": 7, "ESFP": 6, "ENFP": 4, "ENTP": 2}},
                # Set A (展望)
                {"txt": "C. 平靜。這只是人生的一個階段，我已經準備好面對下一關。", "scores": {"ENTJ": 7, "ESTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # Set D (感動)
                {"txt": "D. 看著校園的角落，心中充滿了酸酸甜甜的詩意感觸。", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}}
            ]
        },
        {
            "q": "22. [同學會] 多年後，你希望大家怎麼記得你？",
            "opts": [
                # Set B (溫暖)
                {"txt": "A. 班上的核心人物，那個總是帶給大家溫暖的人。", "scores": {"ISFJ": 7, "ESFJ": 6, "ENFJ": 4, "INFJ": 2}},
                # Set A (成功)
                {"txt": "B. 最成功的人。事業有成、意氣風發的樣子。", "scores": {"ESTJ": 7, "ENTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # Set D (獨特)
                {"txt": "C. 一個獨特的人。雖然話不多，但很有才華。", "scores": {"INTP": 7, "ISTP": 6, "ISFP": 4, "INFP": 2}},
                # Set C (開心果)
                {"txt": "D. 只要想到我，大家就會忍不住笑出來的開心果。", "scores": {"ENFP": 7, "ENTP": 6, "ESTP": 4, "ESFP": 2}}
            ]
        },
        {
            "q": "23. [回到過去] 對高一入學的自己說什麼？",
            "opts": [
                # Set A (勸誡)
                {"txt": "A. 「多讀點書，少做白日夢，投資自己才是真的。」", "scores": {"ISTJ": 7, "INTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # Set C (勇敢)
                {"txt": "B. 「勇敢一點！去告白、去翹課、去瘋狂，別留遺憾！」", "scores": {"ESFP": 7, "ESTP": 6, "ENTP": 4, "ENFP": 2}},
                # Set D (自我)
                {"txt": "C. 「不要那麼在意別人的眼光，你已經很好了。」", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}},
                # Set B (關係)
                {"txt": "D. 「珍惜身邊的朋友，他們是你最寶貴的財富。」", "scores": {"INFJ": 7, "ISFJ": 6, "ESFJ": 4, "ENFJ": 2}}
            ]
        },
        {
            "q": "24. [青春] 「青春」這兩個字代表什麼？",
            "opts": [
                # Set C (體驗)
                {"txt": "A. 是汗水與衝動。是跌倒了再爬起來的痛快。", "scores": {"ENTP": 7, "ENFP": 6, "ESFP": 4, "ESTP": 2}},
                # Set D (夢幻)
                {"txt": "B. 是一場還沒醒的夢。充滿了粉紅泡泡和藍色憂鬱。", "scores": {"ISTP": 7, "INTP": 6, "INFP": 4, "ISFP": 2}},
                # Set A (成長)
                {"txt": "C. 是成長的必經之路。累積知識與經驗的過程。", "scores": {"INTJ": 7, "ISTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # Set B (夥伴)
                {"txt": "D. 是與夥伴們一起奮鬥、一起流淚的美好時光。", "scores": {"ENFJ": 7, "INFJ": 6, "ISFJ": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "25. [最後一課] 學校裡學到最重要的一課？",
            "opts": [
                # Set A (現實)
                {"txt": "A. 社會是現實的，實力才是硬道理。", "scores": {"ENTJ": 7, "ESTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # Set B (人脈)
                {"txt": "B. 朋友是一輩子的資產，懂得待人處事最重要。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}},
                # Set D (獨立)
                {"txt": "C. 保持獨立思考，不要盲從權威或隨波逐流。", "scores": {"INTP": 7, "ISTP": 6, "ISFP": 4, "INFP": 2}},
                # Set C (夢想)
                {"txt": "D. 永遠保持好奇心，勇敢追逐不切實際的夢想。", "scores": {"ENFP": 7, "ENTP": 6, "ESTP": 4, "ESFP": 2}}
            ]
        }
    ],
    "cyber": [
        # ==========================================
        # Chapter 1: 霓虹城市的甦醒 (完全對應 School Ch1 分數)
        # ==========================================
        {
            "q": "1. [連線] 在膠囊旅館醒來，大腦連上網路，你的第一個直覺動作？",
            "opts": [
                # 對應 School Q1-A (ESFJ 主場) -> 社交
                {"txt": "A. 查看社群訊息，確認家人朋友的位置，發送早安訊號。", "scores": {"ESFJ": 7, "ENFJ": 6, "ISFJ": 4, "INFJ": 2}},
                # 對應 School Q1-B (INTJ 主場) -> 觀察
                {"txt": "B. 啟動義眼掃描，分析今日空氣毒素指數與新聞，規劃最佳路徑。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # 對應 School Q1-C (ESTP 主場) -> 焦點
                {"txt": "C. 穿上最閃亮的發光夾克，騎上重機炸街，享受路人的目光。", "scores": {"ESTP": 7, "ESFP": 6, "ENTP": 4, "ENFP": 2}},
                # 對應 School Q1-D (INFP 主場) -> 隱形
                {"txt": "D. 拉上遮光廉，開啟「勿擾模式」，不想面對這個喧囂的電子世界。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}}
            ]
        },
        {
            "q": "2. [衝突] 街頭幫派在火拼，沒人敢過去，氣氛緊張。你會？",
            "opts": [
                # 對應 School Q2-A (ESTJ 主場) -> 掌控
                {"txt": "A. 「這群烏合之眾...」站出來指揮現場秩序，建立臨時安全區。", "scores": {"ESTJ": 7, "ENTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # 對應 School Q2-B (ENTP 主場) -> 搞事
                {"txt": "B. 駭入路邊的廣告看板改成搞笑迷因圖，試圖讓氣氛瞬間破功。", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # 對應 School Q2-C (ISFJ 主場) -> 責任
                {"txt": "C. 雖然害怕，但還是默默把受傷的路人拉到掩體後方急救。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}},
                # 對應 School Q2-D (ISTP 主場) -> 裝死
                {"txt": "D. 啟動光學迷彩隱身，貼著牆邊溜走，心裡默唸「別看到我」。", "scores": {"ISTP": 7, "INTP": 6, "INFP": 4, "ISFP": 2}}
            ]
        },
        {
            "q": "3. [改裝] 地下診所提供免費的身體改造體驗，你會選擇？",
            "opts": [
                # 對應 School Q3-A (ESFP 主場) -> 舞台/外觀
                {"txt": "A. 炫彩皮膚與聲光模組。我要成為夜城最閃耀的賽博龐克明星！", "scores": {"ESFP": 7, "ESTP": 6, "ENFP": 4, "ENTP": 2}},
                # 對應 School Q3-B (INTP 主場) -> 技術/算力
                {"txt": "B. 大腦協處理器。提升運算速度，能瞬間破解防火牆與學習知識。", "scores": {"INTP": 7, "ISTP": 6, "ISFP": 4, "INFP": 2}},
                # 對應 School Q3-C (ENTJ 主場) -> 權力/控制
                {"txt": "C. 戰術指揮植入物。能同時操控多台無人機，掌握戰場全局。", "scores": {"ENTJ": 7, "ESTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # 對應 School Q3-D (INFJ 主場) -> 心靈/感知
                {"txt": "D. 情感共鳴晶片。能直接讀取他人的情緒波動，理解人心的深處。", "scores": {"INFJ": 7, "ISFJ": 6, "ENFJ": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "4. [委託] 駭客朋友盜取了公司的機密數據，請求你幫忙藏匿。你會？",
            "opts": [
                # 對應 School Q4-A (ENFP 主場) -> 啟發/共犯
                {"txt": "A. 「交給我吧！我們一起把這份數據公開，揭發公司的惡行！」", "scores": {"ENFP": 7, "ENTP": 6, "ESFP": 4, "ESTP": 2}},
                # 對應 School Q4-B (ISTJ 主場) -> 原則
                {"txt": "B. 「不行。這是盜竊行為，而且會惹上殺身之禍，我不能收。」", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # 對應 School Q4-C (ISFP 主場) -> 包庇
                {"txt": "C. 裝作不知道裡面是什麼。「你放在那邊就好，我什麼都沒看到。」", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}},
                # 對應 School Q4-D (ENFJ 主場) -> 好人
                {"txt": "D. 「你這樣太危險了...」一邊唸他，一邊還是幫他找了個安全的地方。", "scores": {"ENFJ": 7, "ESFJ": 6, "ISFJ": 4, "INFJ": 2}}
            ]
        },
        {
            "q": "5. [休息] 在充滿酸雨的夜晚，這段時間你通常在做什麼？",
            "opts": [
                # 對應 School Q5-A (INFP 主場) -> 獨處 (School V8 Q5 Opt A 是 INFP+7)
                {"txt": "A. 躲在狹窄的伺服器機房裡，聽著雨聲和機器運轉聲，享受孤獨。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}},
                # 對應 School Q5-B (ESTP 主場) -> 玩樂 (School V8 Q5 Opt B 是 ESTP+7)
                {"txt": "B. 去地下舞廳狂歡，嗑點電子迷幻藥，讓意識與數據流同步。", "scores": {"ESTP": 7, "ESFP": 6, "ENTP": 4, "ENFP": 2}},
                # 對應 School Q5-C (INTJ 主場) -> 進修
                {"txt": "C. 下載新的技能晶片，學習戰鬥或駭客技術。力量就是一切。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # 對應 School Q5-D (ESFJ 主場) -> 照顧
                {"txt": "D. 在貧民窟分發合成食物，或是聽流浪的改造人訴說過去。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}}
            ]
        },

        # ==========================================
        # Chapter 2: 系統與漏洞 (對應 School Ch2)
        # ==========================================
        {
            "q": "6. [任務] 接到一個難度極高的潛入任務，你的策略是？",
            "opts": [
                # 對應 School Q6-A (ISFJ 主場) -> 計畫
                {"txt": "A. 花一個月監控守衛路線，制定完美的時刻表，分秒不差地執行。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}},
                # 對應 School Q6-B (ENTP 主場) -> 爆發/隨機
                {"txt": "B. 隨機應變！製造一場大爆炸當掩護，趁亂衝進去，賭運氣。", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # 對應 School Q6-C (INTP 主場) -> 分析/後門
                {"txt": "C. 寫一個病毒程式，從後門駭入系統，癱瘓所有監視器和防禦網。", "scores": {"INTP": 7, "ISTP": 6, "INFP": 4, "ISFP": 2}},
                # 對應 School Q6-D (ENTJ 主場) -> 領導/分配 (School V8 Q6 Opt D 是 ENTJ+7)
                {"txt": "D. 組織一支專業團隊，分配每個人負責的區域，互相掩護。", "scores": {"ENTJ": 7, "ESTJ": 6, "ENFJ": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "7. [戰鬥] 遭遇戰鬥機器人，你的武器卡彈了，剩最後 10 秒。你會？",
            "opts": [
                # 對應 School Q7-A (ESFP 主場) -> 英雄 (School V8 Q7 Opt A 是 ESFP+7)
                {"txt": "A. 「看我的！」扔掉槍，拔出高頻振動刀，華麗地衝上去近身肉搏。", "scores": {"ESFP": 7, "ESTP": 6, "ENFP": 4, "ENTP": 2}},
                # 對應 School Q7-B (ENTJ 主場) -> 戰術 (School V8 Q7 Opt B 是 ENTJ+7)
                {"txt": "B. 迅速下令隊友進行掩護射擊，自己利用地形進行戰術撤退。", "scores": {"ENTJ": 7, "ESTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # 對應 School Q7-C (ENFJ 主場) -> 激勵
                {"txt": "C. 大聲激勵隊友：「不要怕！集中火力攻擊它的關節！」穩住士氣。", "scores": {"ENFJ": 7, "ENFP": 6, "ESFJ": 4, "ISFP": 2}},
                # 對應 School Q7-D (INFJ 主場) -> 洞察 (School V8 Q7 Opt D 是 INFJ+7)
                {"txt": "D. 冷靜觀察機器人的動作模式，尋找裝甲縫隙中的緊急停止按鈕。", "scores": {"INFJ": 7, "INTP": 6, "ISFJ": 4, "ISTP": 2}}
            ]
        },
        {
            "q": "8. [違法] 發現搭檔偷偷販賣公司機密賺外快，被你撞見。你會？",
            "opts": [
                # 對應 School Q8-A (ISFP 主場) -> 裝傻
                {"txt": "A. 裝作沒看見。「這世道大家都不容易。」選擇沉默保護他。", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}},
                # 對應 School Q8-B (ISTJ 主場) -> 正直
                {"txt": "B. 「你這是違反契約。」當面制止他，如果不聽就向上級匯報。", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # 對應 School Q8-C (ENFP 主場) -> 詭辯/分贓 (School V8 Q8 Opt C 是 ENFP+7)
                {"txt": "C. 「分我一半，我就當作沒看到。」或者幫他想個更好的銷贓管道。", "scores": {"ENFP": 7, "ENTP": 6, "ESFP": 4, "ESTP": 2}},
                # 對應 School Q8-D (INFJ 主場) -> 求情/勸導 (School V8 Q8 Opt D 是 INFJ+7)
                {"txt": "D. 私下勸他收手，這太危險了，我不希望看到你出事。", "scores": {"INFJ": 7, "ISFJ": 6, "ENFJ": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "9. [市集] 要在黑市擺攤賺錢，你打算賣什麼？",
            "opts": [
                # 對應 School Q9-A (ESTP 主場) -> 娛樂/鬼屋 (School V8 Q9 Opt A 是 ESTP+7)
                {"txt": "A. 販賣最新的「夢境體驗晶片」，讓大家體驗虛擬的刺激快感！", "scores": {"ESTP": 7, "ESFP": 6, "ENTP": 4, "ENFP": 2}},
                # 對應 School Q9-B (INTJ 主場) -> 營利 (School V8 Q9 Opt B 是 INTJ+7)
                {"txt": "B. 高效能的破解軟體或情報販賣。這是剛需，利潤最高。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # 對應 School Q9-C (INFP 主場) -> 氛圍
                {"txt": "C. 手工製作的復古工藝品。在這個冰冷的科技世界，販賣「溫度」。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}},
                # 對應 School Q9-D (ESFJ 主場) -> 服務 (School V8 Q9 Opt D 是 ESFJ+7)
                {"txt": "D. 開一間會傾聽煩惱的義體維修店，把賺到的錢捐給孤兒院。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}}
            ]
        },
        {
            "q": "10. [傳說] 聽說貧民窟深處有一個會吃人的 AI 鬼屋。你會？",
            "opts": [
                # 對應 School Q10-A (ENTP 主場) -> 冒險
                {"txt": "A. 「太酷了！」帶上裝備去探險，看能不能抓到那個 AI 賣錢。", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # 對應 School Q10-B (ESTJ 主場) -> 守規 (School V8 Q10 Opt B 是 ESTJ+7)
                {"txt": "B. 那是危險區域，既然政府封鎖了就別去，安全第一。", "scores": {"ESTJ": 7, "ENTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # 對應 School Q10-C (INTP 主場) -> 求證 (School V8 Q10 Opt C 是 INTP+7)
                {"txt": "C. 遠端駭入該區域的監視器。我想分析這個 AI 的代碼結構。", "scores": {"INTP": 7, "ISTP": 6, "INFP": 4, "ISFP": 2}},
                # 對應 School Q10-D (ISFJ 主場) -> 靈性/勸導 (School V8 Q10 Opt D 是 ISFJ+7)
                {"txt": "D. 覺得那個 AI 可能擁有悲傷的靈魂...但為了安全還是勸大家別去。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}}
            ]
        },

        # ==========================================
        # Chapter 3: 虛擬與現實 (對應 School Ch3)
        # ==========================================
        {
            "q": "11. [心動] 在酒吧遇到一個氣質獨特的生化人，你的反應？",
            "opts": [
                # 對應 School Q11-A (ENFP 主場) -> 幻想 (School V8 Q11 Opt A 是 ENFP+7)
                {"txt": "A. 「天啊！這是命運的邂逅！我們的型號一定很匹配！」", "scores": {"ENFP": 7, "ESFP": 6, "INFP": 4, "ESFJ": 2}},
                # 對應 School Q11-B (ISTJ 主場) -> 理性
                {"txt": "B. 「他可能是在掃描我身上的植入物價值。」保持警戒。", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # 對應 School Q11-C (INFP 主場) -> 害羞 (School V8 Q11 Opt C 是 INFP+7)
                {"txt": "C. 假裝在看全息菜單，其實心跳加速，偷偷用餘光瞄他。", "scores": {"INFP": 7, "INFJ": 6, "ISFP": 4, "ISFJ": 2}},
                # 對應 School Q11-D (ESTP 主場) -> 主動 (School V8 Q11 Opt D 是 ESTP+7)
                {"txt": "D. 直接走過去請他喝一杯：「你的義眼型號很特別，哪裡改的？」", "scores": {"ESTP": 7, "ENTP": 6, "ENTJ": 4, "ESFP": 2}}
            ]
        },
        {
            "q": "12. [告白] 決定向心儀的駭客告白，你會用什麼方式？",
            "opts": [
                # 對應 School Q12-A (INFJ 主場) -> 深情
                {"txt": "A. 寫一段加密的詩歌代碼，只有他能解開看到裡面的情書。", "scores": {"INFJ": 7, "INFP": 6, "ISFJ": 4, "ISFP": 2}},
                # 對應 School Q12-B (ENFP 主場) -> 公開 (School V8 Q12 Opt B 是 ENFP+7)
                {"txt": "B. 駭入全城的廣告看板，把他的名字和我的愛意投射在夜空中！", "scores": {"ENFP": 7, "ENTP": 6, "ESFP": 4, "ESTP": 2}},
                # 對應 School Q12-C (ENTJ 主場) -> 務實 (School V8 Q12 Opt C 是 ENTJ+7)
                {"txt": "C. 直接約出來講清楚。「我喜歡妳的技術，我們要不要結盟(交往)？」", "scores": {"ENTJ": 7, "ESTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # 對應 School Q12-D (ESFJ 主場) -> 儀式 (School V8 Q12 Opt D 是 ESFJ+7)
                {"txt": "D. 在虛擬實境(VR)中建造一個完美的世界，在那裡向他表白。", "scores": {"ESFJ": 7, "ENFJ": 6, "ESFP": 4, "ENFP": 2}}
            ]
        },
        {
            "q": "13. [失戀] 朋友被網戀對象騙了錢和感情，你怎麼安慰？",
            "opts": [
                # 對應 School Q13-A (ESFJ 主場) -> 共情 (School V8 Q13 Opt A 是 ESFJ+7)
                {"txt": "A. 陪他一起大罵那個騙子，給他大大的擁抱，陪他喝到天亮。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}},
                # 對應 School Q13-B (ESTP 主場) -> 轉移 (School V8 Q13 Opt B 是 ESTP+7)
                {"txt": "B. 「別難過！走，我們去賭場贏回來，再去換個更帥的義體！」", "scores": {"ESTP": 7, "ESFP": 6, "ENTP": 4, "ENFP": 2}},
                # 對應 School Q13-C (INTJ 主場) -> 解決 (School V8 Q13 Opt C 是 INTJ+7)
                {"txt": "C. 追蹤騙子的 IP 位置。「別哭，我已經找到他在哪了，我們去討債。」", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # 對應 School Q13-D (ISTP 主場) -> 陪伴 (School V8 Q13 Opt D 是 ISTP+7)
                {"txt": "D. 什麼都不說，只是靜靜地陪他看著雨中的霓虹燈，遞給他毛巾。", "scores": {"ISTP": 7, "INTP": 6, "ISFP": 4, "INFP": 2}}
            ]
        },
        {
            "q": "14. [謠言] 網路上流傳你是企業走狗的不實謠言，你會？",
            "opts": [
                # 對應 School Q14-A (ESTJ 主場) -> 反擊 (School V8 Q14 Opt A 是 ESTJ+7)
                {"txt": "A. 正面迎擊！公開我的交易紀錄，並懸賞找出造謠的人。", "scores": {"ESTJ": 7, "ENTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # 對應 School Q14-B (INTP 主場) -> 受傷 (School V8 Q14 Opt B 是 INTP+7)
                {"txt": "B. 覺得很煩，暫時登出網路，躲回現實世界，不想理會。", "scores": {"INTP": 7, "ISTP": 6, "INFP": 4, "ISFP": 2}},
                # 對應 School Q14-C (ENTP 主場) -> 幽默 (School V8 Q14 Opt C 是 ENTP+7)
                {"txt": "C. 轉發謠言並嘲笑它：「企業走狗？他們付得起我的價碼嗎？哈哈！」", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # 對應 School Q14-D (ISFJ 主場) -> 清者自清 (School V8 Q14 Opt D 是 ISFJ+7)
                {"txt": "D. 相信我的夥伴會懂我。只要我在乎的人相信我就好。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}}
            ]
        },
        {
            "q": "15. [組隊] 要組隊去荒坂塔偷數據，你最在意隊友的是？",
            "opts": [
                # 對應 School Q15-A (ENFJ 主場) -> 人際 (School V8 Q15 Opt A 是 ENFJ+7)
                {"txt": "A. 大家都要好相處，互相信任，絕對不能有背叛者。", "scores": {"ENFJ": 7, "ESFJ": 6, "ISFJ": 4, "INFJ": 2}},
                # 對應 School Q15-B (ESFP 主場) -> 好玩 (School V8 Q15 Opt B 是 ESFP+7)
                {"txt": "B. 我要跟最瘋狂的那群人一組，這場搶劫一定要夠刺激、夠華麗！", "scores": {"ESFP": 7, "ESTP": 6, "ENFP": 4, "ENTP": 2}},
                # 對應 School Q15-C (ISTJ 主場) -> 安靜 (School V8 Q15 Opt C 是 ISTJ+7)
                {"txt": "C. 隊友不要太多廢話，專業、精準、安靜地完成任務。", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # 對應 School Q15-D (ISFP 主場) -> 隨意 (School V8 Q15 Opt D 是 ISFP+7)
                {"txt": "D. 跟誰都可以，只要給我一個角落讓我安靜做我的事。", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}}
            ]
        },

        # ==========================================
        # Chapter 4: 衝突與抉擇 (對應 School Ch4)
        # ==========================================
        {
            "q": "16. [冤枉] 警察無差別掃描並逮捕路人，你也在其中。你會？",
            "opts": [
                # 對應 School Q16-A (ENFP 主場) -> 抗議 (School V8 Q16 Opt A 是 ENFP+7)
                {"txt": "A. 大聲抗議：「這是濫用職權！我有律師，我要直播你們的暴行！」", "scores": {"ENFP": 7, "ENTP": 6, "ENFJ": 4, "ESFP": 2}},
                # 對應 School Q16-B (ENTJ 主場) -> 服從 (School V8 Q16 Opt B 是 ENTJ+7)
                {"txt": "B. 保持冷靜，配合檢查。現在反抗不划算，出來後再算帳。", "scores": {"ENTJ": 7, "ESTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # 對應 School Q16-C (INFJ 主場) -> 溝通 (School V8 Q16 Opt C 是 INFJ+7)
                {"txt": "C. 試圖跟警官溝通，安撫周圍群眾的情緒，避免衝突升級。", "scores": {"INFJ": 7, "ISFJ": 6, "ENFJ": 4, "ESFJ": 2}},
                # 對應 School Q16-D (ISTP 主場) -> 偷溜 (School V8 Q16 Opt D 是 ISTP+7)
                {"txt": "D. 趁警察不注意，啟動干擾器，從後巷溜之大吉。", "scores": {"ISTP": 7, "INTP": 6, "ESFP": 3, "ENTP": 2}}
            ]
        },
        {
            "q": "17. [經費] 反抗軍基地資金短缺，即將解散。你會？",
            "opts": [
                # 對應 School Q17-A (INTJ 主場) -> 談判 (School V8 Q17 Opt A 是 INTJ+7)
                {"txt": "A. 找金主談判。說服地下大亨投資我們，展示未來的回報。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # 對應 School Q17-B (ESTP 主場) -> 募款 (School V8 Q17 Opt B 是 ESTP+7)
                {"txt": "B. 劫富濟貧！發起一場針對企業的快閃搶劫，炒熱氣氛順便賺錢。", "scores": {"ESTP": 7, "ESFP": 6, "ENFP": 4, "ENTP": 2}},
                # 對應 School Q17-C (ISTP 主場) -> 鑽洞 (School V8 Q17 Opt C 是 ISTP+7)
                {"txt": "C. 寫程式挖礦，或者駭入銀行的休眠帳戶轉移資金。", "scores": {"ISTP": 7, "INTP": 6, "ISFP": 4, "INFP": 2}},
                # 對應 School Q17-D (ESFJ 主場) -> 團結 (School V8 Q17 Opt D 是 ESFJ+7)
                {"txt": "D. 沒錢就轉入地下化吧。只要大家團結，哪裡都是基地。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}}
            ]
        },
        {
            "q": "18. [偷竊] 對手偷走了你研發的病毒代碼並註冊專利。你會？",
            "opts": [
                # 對應 School Q18-A (ESTJ 主場) -> 實力 (School V8 Q18 Opt A 是 ESTJ+7)
                {"txt": "A. 沒關係。那只是舊版本，我腦中已經有更完美的 2.0 版了。", "scores": {"ESTJ": 7, "ENTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # 對應 School Q18-B (INTP 主場) -> 隱忍 (School V8 Q18 Opt B 是 INTP+7)
                {"txt": "B. 雖然很氣憤，但不想惹上大企業的法務部，只好吞下去。", "scores": {"INTP": 7, "ISTP": 6, "INFP": 4, "ISFP": 2}},
                # 對應 School Q18-C (ENTP 主場) -> 報復 (School V8 Q18 Opt C 是 ENTP+7)
                {"txt": "C. 以牙還牙！駭入他的神經網絡，讓他當眾出醜。", "scores": {"ENTP": 7, "ENFP": 6, "ESTP": 4, "ESFP": 2}},
                # 對應 School Q18-D (ISFJ 主場) -> 原諒 (School V8 Q18 Opt D 是 ISFJ+7)
                {"txt": "D. 相信他有苦衷，甚至私下問他是不是缺錢才這麼做。", "scores": {"ISFJ": 7, "INFJ": 6, "ESFJ": 4, "ENFJ": 2}}
            ]
        },
        {
            "q": "19. [計畫] 團隊要執行「推翻企業」的終極計畫，你想擔任？",
            "opts": [
                # 對應 School Q19-A (ENFJ 主場) -> 主角 (School V8 Q19 Opt A 是 ENFJ+7)
                {"txt": "A. 總指揮或精神領袖。我要發表演說，喚醒市民的覺醒！", "scores": {"ENFJ": 7, "ESFJ": 6, "ISFJ": 4, "INFJ": 2}},
                # 對應 School Q19-B (ISFP 主場) -> 幕後 (School V8 Q19 Opt B 是 ISFP+7)
                {"txt": "B. 宣傳設計。製作反抗軍的標誌與塗鴉，傳遞自由的訊息。", "scores": {"ISFP": 7, "INFP": 6, "ISTP": 4, "INTP": 2}},
                # 對應 School Q19-C (ESFP 主場) -> 配角 (School V8 Q19 Opt C 是 ESFP+7)
                {"txt": "C. 誘餌。我在前線製造混亂吸引火力，讓主力部隊潛入。", "scores": {"ESFP": 7, "ESTP": 6, "ENTP": 4, "ENFP": 2}},
                # 對應 School Q19-D (ISTJ 主場) -> 音控 (School V8 Q19 Opt D 是 ISTJ+7)
                {"txt": "D. 系統監控。我在後台切斷警報、解鎖大門，確保行動順利。", "scores": {"ISTJ": 7, "INTJ": 6, "ESTJ": 4, "ENTJ": 2}}
            ]
        },
        {
            "q": "20. [備份] 在大腦被格式化之前，你只能備份一段記憶。你會選？",
            "opts": [
                # 對應 School Q20-A (INFP 主場) -> 初心 (School V8 Q20 Opt A 是 INFP+7)
                {"txt": "A. 小時候第一次看到真正星空的感動。那是我的初心。", "scores": {"INFP": 7, "ISFP": 6, "INTP": 4, "ISTP": 2}},
                # 對應 School Q20-B (INFJ 主場) -> 回憶 (School V8 Q20 Opt B 是 INFJ+7)
                {"txt": "B. 與戰友們在天台喝酒慶祝的畫面。那是友情的證明。", "scores": {"INFJ": 7, "ISFJ": 6, "ESFJ": 4, "ENFJ": 2}},
                # 對應 School Q20-C (INTJ 主場) -> 預測 (School V8 Q20 Opt C 是 INTJ+7)
                {"txt": "C. 我畢生研究的技術核心代碼。知識必須傳承下去。", "scores": {"INTJ": 7, "ISTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # 對應 School Q20-D (ENTP 主場) -> 價值 (School V8 Q20 Opt D 是 ENTP+7)
                {"txt": "D. 我銀行帳戶的密碼。沒有錢，復活了也沒法活！", "scores": {"ENTP": 7, "ENFP": 6, "ESFP": 4, "ESTP": 2}}
            ]
        },

        # ==========================================
        # Chapter 5: 傳奇的終章 (對應 School Ch5)
        # ==========================================
        {
            "q": "21. [結局] 企業倒台了，舊時代結束。你的真實感受？",
            "opts": [
                # 對應 School Q21-A (ESFJ 主場) -> 捨不得 (School V8 Q21 Opt A 是 ESFJ+7)
                {"txt": "A. 有點感傷。雖然舊時代很糟，但那裡也有我們熟悉的一切。", "scores": {"ESFJ": 7, "ISFJ": 6, "ENFJ": 4, "ESFP": 2}},
                # 對應 School Q21-B (ISTP 主場) -> 解脫 (School V8 Q21 Opt B 是 ISTP+7)
                {"txt": "B. 「終於解脫了！」這爛透的世界終於毀了，我要自由！", "scores": {"ISTP": 7, "INTP": 6, "ESTP": 4, "ENTP": 2}},
                # 對應 School Q21-C (ENTJ 主場) -> 展望 (School V8 Q21 Opt C 是 ENTJ+7)
                {"txt": "C. 平靜。破壞容易建設難，現在才是真正挑戰的開始。", "scores": {"ENTJ": 7, "INTJ": 6, "ESTJ": 4, "ISTJ": 2}},
                # 對應 School Q21-D (INFP 主場) -> 感動 (School V8 Q21 Opt D 是 INFP+7)
                {"txt": "D. 看著城市的廢墟長出新芽，心中充滿了酸酸甜甜的詩意。", "scores": {"INFP": 7, "INFJ": 6, "ISFP": 4, "ENFP": 2}}
            ]
        },
        {
            "q": "22. [傳說] 多年後，你希望夜城的人怎麼記得你？",
            "opts": [
                # 對應 School Q22-A (ISFJ 主場) -> 溫暖 (School V8 Q22 Opt A 是 ISFJ+7)
                {"txt": "A. 地下城的守護者。那個在黑暗中給予大家溫暖與食物的人。", "scores": {"ISFJ": 7, "ESFJ": 6, "ENFJ": 4, "INFJ": 2}},
                # 對應 School Q22-B (ESTJ 主場) -> 成功 (School V8 Q22 Opt B 是 ESTJ+7)
                {"txt": "B. 新秩序的締造者。重建了這座城市，讓它恢復運作的人。", "scores": {"ESTJ": 7, "ENTJ": 6, "INTJ": 4, "ISTJ": 2}},
                # 對應 School Q22-C (INTP 主場) -> 獨特 (School V8 Q22 Opt C 是 INTP+7)
                {"txt": "C. 一個都市傳說。沒人見過我的真面目，但我無所不在。", "scores": {"INTP": 7, "ISFP": 6, "INFJ": 4, "ISTP": 2}},
                # 對應 School Q22-D (ENFP 主場) -> 開心果 (School V8 Q22 Opt D 是 ENFP+7)
                {"txt": "D. 只要提到我，大家就會想起那段最瘋狂、最快樂的時光。", "scores": {"ENFP": 7, "ENTP": 6, "ESTP": 4, "ESFP": 2}}
            ]
        },
        {
            "q": "23. [回到過去] 對剛來到夜城的自己說什麼？",
            "opts": [
                # 對應 School Q23-A (ISTJ 主場) -> 勸誡 (School V8 Q23 Opt A 是 ISTJ+7)
                {"txt": "A. 「不要相信任何人，合約看仔細，投資自己才是真的。」", "scores": {"ISTJ": 7, "INTJ": 6, "ENTJ": 4, "ESTJ": 2}},
                # 對應 School Q23-B (ESFP 主場) -> 勇敢 (School V8 Q23 Opt B 是 ESFP+7)
                {"txt": "B. 「大膽一點！去改裝、去相愛、去燃燒，別活得像個機器！」", "scores": {"ESFP": 7, "ESTP": 6, "ENTP": 4, "ENFP": 2}},
                # 對應 School Q23-C (INFJ 主場) -> 自信 (School V8 Q23 Opt C 是 INFJ+7)
                {"txt": "C. 「在這個失去靈魂的城市裡，不要弄丟了你的心。」", "scores": {"INFJ": 7, "INFP": 6, "ISFJ": 4, "ISTJ": 2}},
                # 對應 School Q23-D (ENTP 主場) -> 機會 (School V8 Q23 Opt D 是 ENTP+7)
                {"txt": "D. 「記住這個數據漏洞，還有那家公司的股價會崩盤！」", "scores": {"ENTP": 7, "ISTP": 6, "INTP": 4, "ESTP": 2}}
            ]
        },
        {
            "q": "24. [定義] 你覺得「Cyberpunk」代表什麼？",
            "opts": [
                # 對應 School Q24-A (ENTP 主場) -> 體驗 (School V8 Q24 Opt A 是 ENTP+7)
                {"txt": "A. 是金屬與血肉的碰撞。是活在刀口上的刺激。", "scores": {"ENTP": 7, "ENFP": 6, "ESFP": 4, "ESTP": 2}},
                # 對應 School Q24-B (ISTP 主場) -> 夢幻 (School V8 Q24 Opt B 是 ISTP+7)
                {"txt": "B. 是霓虹燈下的孤獨。充滿了科技的絢爛與人性的哀愁。", "scores": {"ISTP": 7, "INTP": 6, "INFP": 4, "ISFP": 2}},
                # 對應 School Q24-C (INTJ 主場) -> 成長 (School V8 Q24 Opt C 是 INTJ+7)
                {"txt": "C. 是混亂中的生存。在失序的世界尋找一絲穩定的過程。", "scores": {"INTJ": 7, "ISTJ": 6, "ESTJ": 4, "ENTJ": 2}},
                # 對應 School Q24-D (ENFJ 主場) -> 夥伴 (School V8 Q24 Opt D 是 ENFJ+7)
                {"txt": "D. 是進化的試錯。人類試圖超越肉體極限的實驗場。", "scores": {"ENFJ": 7, "INFJ": 6, "ISFJ": 4, "ESFJ": 2}}
            ]
        },
        {
            "q": "25. [最後一課] 賽博世界裡學到最重要的一課？",
            "opts": [
                # 對應 School Q25-A (ENTJ 主場) -> 現實 (School V8 Q25 Opt A 是 ENTJ+7)
                {"txt": "A. 科技再發達，弱肉強食的本質永遠不會變。", "scores": {"ENTJ": 7, "ESTJ": 6, "ISTJ": 4, "INTJ": 2}},
                # 對應 School Q25-B (ESFJ 主場) -> 人脈 (School V8 Q25 Opt B 是 ESFJ+7)
                {"txt": "B. 義體可以替換，但真心的夥伴是無法複製的。", "scores": {"ESFJ": 7, "ENFJ": 6, "INFJ": 4, "ISFJ": 2}},
                # 對應 School Q25-C (INTP 主場) -> 獨立 (School V8 Q25 Opt C 是 INTP+7)
                {"txt": "C. 保持獨立的意識，不要被網路輿論或企業宣傳洗腦。", "scores": {"INTP": 7, "ENTP": 6, "ISTP": 4, "INTJ": 2}},
                # 對應 School Q25-D (ISFP 主場) -> 夢想 (School V8 Q25 Opt D 是 ISFP+7) -> 改成接納
                {"txt": "D. 即使身體是機械的，只要靈魂是自由的，我就活著。", "scores": {"ISFP": 7, "INFP": 6, "INFJ": 4, "ENFP": 2}}
            ]
        }
    ],
}

# ==========================================
# 5. 判讀邏輯函數
# ==========================================
def calculate_sorting_result(answers):
    scores = {"fantasy": 0, "zombie": 0, "school": 0, "cyber": 0}
    for ans_code in answers:
        scores[ans_code] += 1
       
    sorted_scores = sorted(scores.items(), key=lambda x: x[1], reverse=True)
   
    top1_theme, top1_score = sorted_scores[0]
    top2_theme, top2_score = sorted_scores[1]
   
    if top1_score == top2_score:
        return "TIE", [top1_theme, top2_theme]
    else:
        return "WIN", top1_theme
# 5-2. 正式劇本算分函數 (多贏家版)
# ==========================================
# ==========================================
# 5-2. 正式劇本算分函數 (3分誤差寬容版)
# ==========================================
def calculate_mbti(user_answers, question_list):
    # 1. 初始化 16 人格分數板
    scores = {key: 0 for key in ["ESTJ", "ENTJ", "ESFJ", "ENFJ", "ISTJ", "ISFJ", "INTJ", "INFJ", "ESTP", "ESFP", "ENTP", "ENFP", "ISTP", "ISFP", "INTP", "INFP"]}
   
    # 2. 跑迴圈對答案 (算分邏輯不變)
    for i, choice_index in enumerate(user_answers):
        if choice_index is not None:
            points_table = question_list[i]["opts"][choice_index]["scores"]
            for mbti, points in points_table.items():
                if mbti in scores:
                    scores[mbti] += points

    # 3. ★★★ 關鍵修改：找出最高分，並包含差距 3 分以內的人 ★★★
   
    # 先找出全場最高分 (例如 100 分)
    max_score = max(scores.values())
   
    # 設定門檻：最高分 - 3 (例如 100 - 3 = 97 分)
    # 只要大於等於 97 分的，通通算贏家
    threshold = max_score - 3
   
    # 篩選出符合資格的人格
    final_mbtis = [mbti for mbti, score in scores.items() if score >= threshold]
   
    # (選用) 為了讓顯示好看，我們可以依照分數「由高到低」重新排序一下
    # 這樣 100 分的會排在前面，97 分的排在後面
    final_mbtis.sort(key=lambda x: scores[x], reverse=True)
   
    return final_mbtis
# ==========================================
# 6. 頁面 A: 首頁 (Landing Page)
# ==========================================
if st.session_state.page == 'landing':
    st.markdown('<div class="big-title">多重宇宙 MBTI</div>', unsafe_allow_html=True)
    st.markdown('<div class="sub-title">劇本設定與角色校準</div>', unsafe_allow_html=True)
   
    st.number_input("請輸入你的年齡", min_value=1, max_value=100, value=18)
    st.write("---")
   
    st.write("### 🔮 前導測試：尋找你的靈魂歸屬")
    st.info("請依照直覺回答下列 5 題，系統將為你開啟最適合的平行宇宙。")

    with st.form("sorting_form"):
        user_choices = []
        for i, item in enumerate(SORTING_QUIZ):
            st.subheader(item["q"])
            choice = st.radio(
                f"問題 {i+1}",
                item["opts"],
                format_func=lambda x: x[0],
                index=None,
                key=f"sorting_{i}"
            )
            if choice:
                user_choices.append(choice[1])
            st.write("")
           
        submitted = st.form_submit_button("🚀 啟動傳送門", type="primary")
       
        if submitted:
            if len(user_choices) < 5:
                st.error("⚠️ 還有題目沒選喔！請完成所有問題再傳送。")
            else:
                status, result = calculate_sorting_result(user_choices)
               
                if status == "TIE":
                    st.session_state.tie_themes = result
                    st.session_state.page = 'tie_breaker'
                    st.rerun()
                else:
                    st.session_state.target_theme = result
                    st.session_state.page = 'main_quiz'
                    st.rerun()

# ==========================================
# 7. 頁面 B: 同分決戰頁 (Tie Breaker)
# ==========================================
elif st.session_state.page == 'tie_breaker':
    st.markdown('<div class="big-title"> ⚡命運的分岔點</div>', unsafe_allow_html=True)
    st.warning("偵測到你的靈魂同時與兩個世界產生強烈共鳴...")
   
    if not st.session_state.tie_themes:
        st.error("數據異常，請返回首頁")
        if st.button("回首頁"):
            st.session_state.page = 'landing'
            st.rerun()
    else:
        st.write("請做出最後的抉擇，這將決定你的命運。")
       
        theme_a = st.session_state.tie_themes[0]
        theme_b = st.session_state.tie_themes[1]
       
        tie_options = {
            "fantasy": "⚔️ 我寧願在魔法世界戰死，也不要平凡活著",
            "zombie": "🧟 我享受在極限狀態下求生的真實恐懼感",
            "school": "🏫 我更在乎人與人之間溫暖的情感連結",
            "cyber": "🤖 人類情感太麻煩，我寧願擁抱理性的數據"
        }
       
        choice = st.radio(
            "你的內心深處更傾向？",
            [
                (tie_options[theme_a], theme_a),
                (tie_options[theme_b], theme_b)
            ],
            format_func=lambda x: x[0]
        )
       
        if st.button("確認命運", type="primary"):
            st.session_state.target_theme = choice[1]
            st.session_state.page = 'main_quiz'
            st.rerun()

# ==========================================
# 8. 頁面 C: 正式題目頁 (劇本頁)
# ==========================================
elif st.session_state.page == 'main_quiz':
    current_theme = st.session_state.target_theme # 1. 看看使用者的票是哪個宇宙
   
    # 2. 標題對照表
    titles = {
        "fantasy": "🏰 異世界轉生篇",
        "zombie": "🧟 末日喪屍篇",
        "school": "🏫 青春校園篇",
        "cyber": "🤖 賽博龐克篇"
    }
   
    # 3. 顯示大標題
    if current_theme in titles:
        st.markdown(f'<div class="big-title">{titles[current_theme]}</div>', unsafe_allow_html=True)
    else:
        st.markdown(f'<div class="big-title">{current_theme}</div>', unsafe_allow_html=True)

    # 4. ★★★去倉庫拿題目 ★★★
    # 從 ALL_QUIZZES 字典裡，根據 current_theme (例如 'zombie') 抓出對應的那 25 題
    questions = ALL_QUIZZES[current_theme]

    # 安全檢查：如果這個宇宙還沒寫題目 (例如 school)，就顯示施工中
    if not questions:
        st.warning("🚧 這個宇宙正在構建中，編劇還在趕稿...")
        if st.button("回首頁"):
            st.session_state.page = 'landing'
            st.rerun()
    else:
        # 5. 建立表單，開始顯示題目
        st.write("---")
        with st.form("main_quiz_form"):
            user_answers = [] # 用來存這 25 題的答案
           
            # 這裡的 questions 會根據你選喪屍還是異世界而改變！
            for i, q_data in enumerate(questions):
                st.subheader(q_data["q"]) # 顯示題目
               
                choice = st.radio(
                    f"Q{i+1}",
                    q_data["opts"],
                    format_func=lambda x: x["txt"], # 只顯示選項文字
                    index=None,
                    key=f"mq_{current_theme}_{i}"
                )
               
                # 記錄使用者選了第幾個選項 (0, 1, 2, 3)
                if choice:
                    # 我們需要知道他選的是列表裡的第幾個，才能去查分數
                    idx = q_data["opts"].index(choice)
                    user_answers.append(idx)
                else:
                    user_answers.append(None) # 沒選就存 None
               
                st.write("") # 留白
           
            submit = st.form_submit_button("查看最終結果", type="primary")
           
            if submit:
                # 檢查有沒有漏填
                if None in user_answers:
                    st.error("⚠️ 還有題目沒寫完喔！請檢查一下。")
                else:
                    # 呼叫剛剛寫的新算分函數
                    result_mbti = calculate_mbti(user_answers, questions)
                   
                    # 存結果，並跳轉到結果頁 (Result Page)
                    st.session_state.final_result = result_mbti
                    st.session_state.page = 'result_page' # 這是我們下一步要做的
                    st.rerun()
# ==========================================
# 9. 頁面 D: 最終結果頁 (整合修復版)
# ==========================================
# ==========================================
# 9. 頁面 D: 最終結果頁 (含寄信功能版)
# ==========================================
elif st.session_state.page == 'result_page':
    final_results = st.session_state.final_result
    # 取得當前宇宙名稱 (寄信要用)
    current_theme = st.session_state.get('target_theme', 'zombie')
   
    # 只在剛進來時放一次氣球，避免每次按按鈕都放
    if 'has_balloons' not in st.session_state:
        st.balloons()
        st.session_state.has_balloons = True
   
    if len(final_results) > 1:
        st.success(f"⚡ 系統偵測到 {len(final_results)} 種靈魂波長！你是罕見的複合型人格！")
    else:
        st.success("🎯 系統分析完成！這就是真實的你。")

    st.write("")

    # --- 顯示卡片迴圈 (保持不變) ---
    for mbti_type in final_results:
        default_info = {
            "title": "未知", "color": ["#333", "#333"], "desc": "資料缺失",
            "match": "?", "clash": "?",
            "strengths": ["未知"], "weaknesses": ["未知"], "career": "未知"
        }
        info = MBTI_INFO.get(mbti_type, default_info)
        c1, c2 = info['color']
       
        # 標題
        st.markdown(f"""
        <div style="text-align: center;">
            <h1 style="font-size: 80px; margin: 0; background: -webkit-linear-gradient(45deg, {c1}, {c2}); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                {mbti_type}
            </h1>
            <h2 style="font-size: 30px; color: #555; margin-top: -10px;">{info['title']}</h2>
        </div>
        """, unsafe_allow_html=True)
       
        # 裝飾條
        st.markdown(f"""
        <div style="display: flex; gap: 5px; margin-bottom: 20px;">
            <div style="flex: 1; height: 10px; background-color: {c1}; border-radius: 5px;"></div>
            <div style="flex: 1; height: 10px; background-color: {c2}; border-radius: 5px;"></div>
        </div>
        """, unsafe_allow_html=True)
       
        # 描述
        st.markdown(f"""
        <div style="background: rgba(255,255,255,0.5); padding: 20px; border-radius: 10px; border-left: 5px solid {c1}; margin-bottom: 20px;">
            <p style="font-size: 18px; line-height: 1.8; color: #333;">{info['desc']}</p>
        </div>
        """, unsafe_allow_html=True)

        # 社交
        col_rel1, col_rel2 = st.columns(2)
        with col_rel1:
            st.markdown(f"""
            <div style="background: white; padding: 15px; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; border: 1px solid #e0e0e0;">
                <h4 style="margin:0; color: #28a745;">❤️ 最佳拍檔</h4>
                <h2 style="margin:5px 0 0 0; color: #333;">{info['match']}</h2>
            </div>
            """, unsafe_allow_html=True)
        with col_rel2:
            st.markdown(f"""
            <div style="background: white; padding: 15px; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); text-align: center; border: 1px solid #e0e0e0;">
                <h4 style="margin:0; color: #dc3545;">💔 容易衝突</h4>
                <h2 style="margin:5px 0 0 0; color: #333;">{info['clash']}</h2>
            </div>
            """, unsafe_allow_html=True)
           
        st.write("")

        # 優劣勢
        col_an1, col_an2 = st.columns(2)
        with col_an1:
            st.markdown(f"<h3 style='color: {c1}; border-bottom: 2px solid {c1};'>✨ 核心優勢</h3>", unsafe_allow_html=True)
            for s in info.get('strengths', []):
                st.markdown(f"**+ {s}**")    
        with col_an2:
            st.markdown(f"<h3 style='color: #666; border-bottom: 2px solid #666;'>⚠️ 潛在盲點</h3>", unsafe_allow_html=True)
            for w in info.get('weaknesses', []):
                st.markdown(f"**- {w}**")
       
        st.write("")

        # 職業
        role_titles = {"zombie": "🧟 末日職業", "fantasy": "⚔️ 異世界職業", "school": "🏫 校園角色", "cyber": "🤖 賽博身分"}
        display_title = role_titles.get(current_theme, "職業推薦")
       
        career_dict = info.get('career', {})
        if isinstance(career_dict, dict):
            career_text = career_dict.get(current_theme, "自由職業者")
        else:
            career_text = str(career_dict)

        st.markdown(f"""
        <div style="background-color: #f0f2f6; padding: 15px; border-radius: 10px; margin-top: 10px;">
            <h4 style="margin:0; color: #333;">{display_title}</h4>
            <p style="font-size: 20px; font-weight: bold; color: {c2}; margin: 5px 0 0 0;">{career_text}</p>
        </div>
        """, unsafe_allow_html=True)

        st.write("---")

    # ★★★ 新增：寄信功能區塊 ★★★
    st.write("### 📧 保存你的分析報告")
    with st.expander("點擊展開寄信表單"):
        user_email = st.text_input("請輸入你的 Email 地址：", placeholder="name@example.com")
       
        if st.button("🚀 發送報告到信箱"):
            if not user_email:
                st.error("請先輸入 Email 喔！")
            else:
                with st.spinner("正在連線到宇宙訊號塔..."): # 顯示轉圈圈特效
                    success = send_result_email(user_email, final_results, current_theme)
                    if success:
                        st.success(f"✅ 發送成功！請檢查 {user_email} (包含垃圾郵件匣)")
                    else:
                        st.error("❌ 發送失敗，請檢查你的網路或 Email 格式。")

    st.write("")
   
    # 回首頁
    if st.button("🔄 重啟命運 (回到首頁)"):
        st.session_state.page = 'landing'
        st.session_state.user_answers = []
        st.session_state.tie_themes = []
        st.session_state.final_result = None
        if 'has_balloons' in st.session_state:
            del st.session_state.has_balloons
        st.rerun()
# ==========================================
# 10. (開發者工具) 分數平衡檢查器 - 雙密鑰
# ==========================================
def check_balance(questions):
    max_scores = {key: 0 for key in ["ESTJ", "ENTJ", "ESFJ", "ENFJ", "ISTJ", "ISFJ", "INTJ", "INFJ", "ESTP", "ESFP", "ENTP", "ENFP", "ISTP", "ISFP", "INTP", "INFP"]}
    for q in questions:
        current_q_max = {key: 0 for key in max_scores.keys()}
        for opt in q["opts"]:
            for mbti, points in opt["scores"].items():
                if points > current_q_max[mbti]:
                    current_q_max[mbti] = points
        for mbti in max_scores.keys():
            max_scores[mbti] += current_q_max[mbti]
    return max_scores

with st.sidebar:
    st.write("---")
   
    # ★★★ 1.定義兩個密鑰 ★★★
    # 你可以在這裡隨意修改密碼
    VALID_KEYS = ["mikelovethomas", "mikeisadorableandchubby"]
   
    admin_pwd = st.text_input("開發人員通道", type="password", placeholder="輸入密鑰...")

    # 2. 檢查輸入的密碼是否在有效清單中
    if admin_pwd in VALID_KEYS:
        st.success(f"🔓 歡迎回來！權限已解鎖")
        st.header("🔧 劇本平衡檢測儀")
       
        # 3. 列出所有宇宙的按鈕 (不檢查是否為空)
        for theme_key, theme_data in ALL_QUIZZES.items():
            if st.button(f"檢查【{theme_key}】平衡"):
                if len(theme_data) == 0:
                    st.warning("⚠️ 這個劇本目前是空的 (0 題)，所以分數都是 0 喔！")
                else:
                    balance_data = check_balance(theme_data)
                    st.write(f"### {theme_key} 最高分潛力分佈")
                    st.bar_chart(balance_data)
                    max_val = max(balance_data.values())
                    min_val = min(balance_data.values())
                    st.info(f"差距: {max_val - min_val}")
